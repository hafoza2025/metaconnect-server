<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <title>Nerve Center | MetaConnect</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.rtl.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Tajawal:wght@400;500;700;800&display=swap" rel="stylesheet">
    
    <style>
        body { font-family: 'Tajawal', sans-serif; background: #f4f7fa; overflow-x: hidden; }
        
        /* Sidebar */
        .sidebar { width: 250px; height: 100vh; background: #1a202c; color: white; position: fixed; top: 0; right: 0; padding: 20px; z-index: 1000; }
        .sidebar h4 { font-weight: 800; margin-bottom: 40px; letter-spacing: 1px; color: #fff; }
        .sidebar h4 span { color: #3182ce; }
        .nav-link { color: #a0aec0; padding: 12px 15px; border-radius: 8px; transition: 0.3s; margin-bottom: 5px; display: flex; align-items: center; }
        .nav-link i { width: 25px; font-size: 1.1rem; }
        .nav-link:hover, .nav-link.active { background: #2d3748; color: white; transform: translateX(-5px); }
        
        /* Main Content */
        .main-content { margin-right: 250px; padding: 30px; }
        
        /* Cards */
        .stat-card { background: white; padding: 25px; border-radius: 15px; box-shadow: 0 4px 20px rgba(0,0,0,0.03); position: relative; overflow: hidden; transition: transform 0.3s; }
        .stat-card:hover { transform: translateY(-5px); }
        .stat-icon { position: absolute; left: 20px; top: 50%; transform: translateY(-50%); font-size: 3.5rem; opacity: 0.05; }
        
        /* Tables */
        .table-container { background: white; border-radius: 15px; box-shadow: 0 4px 20px rgba(0,0,0,0.03); padding: 20px; overflow: hidden; }
        .table thead th { background: #f8f9fa; border: none; color: #718096; font-weight: 600; padding: 15px; }
        .table tbody td { vertical-align: middle; padding: 15px; }
        
        /* File Modal Styles (ØªØµÙ…ÙŠÙ… Ø§Ù„Ù…Ù„Ù) */
        .modal-content { border: none; border-radius: 20px; box-shadow: 0 20px 50px rgba(0,0,0,0.2); }
        .modal-header { background: #2d3748; color: white; border-bottom: none; padding: 20px 30px; }
        .file-tabs .nav-link { color: #718096; font-weight: 600; border: none; padding: 15px 20px; }
        .file-tabs .nav-link.active { color: #3182ce; border-bottom: 3px solid #3182ce; background: none; }
        
        /* Credentials Box */
        .cred-box { background: #2d3748; color: #63b3ed; padding: 15px; border-radius: 8px; font-family: monospace; position: relative; margin-bottom: 10px; word-break: break-all; }
        .cred-label { color: #a0aec0; font-size: 0.8rem; display: block; margin-bottom: 5px; }
        
        .status-dot { width: 10px; height: 10px; border-radius: 50%; display: inline-block; margin-left: 5px; }
        .dot-success { background: #48bb78; box-shadow: 0 0 10px #48bb78; }
        .dot-danger { background: #f56565; }
    </style>
</head>
<body>

    <!-- Sidebar -->
    <div class="sidebar">
        <h4>Meta<span>Connect</span></h4>
        <nav class="nav flex-column">
            <a class="nav-link active" href="#" onclick="showSection('overview')"><i class="fas fa-chart-pie"></i> Ù†Ø¸Ø±Ø© Ø¹Ø§Ù…Ø©</a>
            <a class="nav-link" href="#" onclick="showSection('companies')"><i class="fas fa-building"></i> Ù…Ù„ÙØ§Øª Ø§Ù„Ø´Ø±ÙƒØ§Øª</a>
            <a class="nav-link" href="#" onclick="showSection('developers')"><i class="fas fa-users-cog"></i> Ø§Ù„Ù…Ø·ÙˆØ±ÙŠÙ†</a>
            <a class="nav-link" href="/admin/support"><i class="fas fa-headset"></i> Ø§Ù„Ø¯Ø¹Ù… Ø§Ù„ÙÙ†ÙŠ</a>
            <div style="margin-top: auto; padding-top: 50px;">
                <a class="nav-link text-danger" href="/logout"><i class="fas fa-power-off"></i> ØªØ³Ø¬ÙŠÙ„ Ø®Ø±ÙˆØ¬</a>
            </div>
        </nav>
    </div>

    <!-- Main Content -->
    <div class="main-content">
        <div class="d-flex justify-content-between align-items-center mb-4">
            <h3 class="fw-bold text-dark">Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ… Ø§Ù„Ù…Ø±ÙƒØ²ÙŠØ©</h3>
            <div class="d-flex align-items-center gap-2">
                <span class="badge bg-success px-3 py-2 rounded-pill"><i class="fas fa-wifi"></i> Ù…ØªØµÙ„</span>
                <span class="text-muted small" id="lastUpdate">ØªØ­Ø¯ÙŠØ«: Ø§Ù„Ø¢Ù†</span>
            </div>
        </div>

        <!-- Stats Cards -->
        <div class="row g-4 mb-4">
            <div class="col-md-3">
                <div class="stat-card">
                    <i class="fas fa-file-invoice-dollar stat-icon text-primary"></i>
                    <h6 class="text-muted">Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„ÙÙˆØ§ØªÙŠØ±</h6>
                    <h2 class="fw-bold mb-0" id="statTotalInvoices">...</h2>
                </div>
            </div>
            <div class="col-md-3">
                <div class="stat-card">
                    <i class="fas fa-building stat-icon text-warning"></i>
                    <h6 class="text-muted">Ø§Ù„Ø´Ø±ÙƒØ§Øª Ø§Ù„Ù…Ø³Ø¬Ù„Ø©</h6>
                    <h2 class="fw-bold mb-0" id="statTotalCompanies">...</h2>
                </div>
            </div>
            <div class="col-md-3">
                <div class="stat-card">
                    <i class="fas fa-users stat-icon text-success"></i>
                    <h6 class="text-muted">Ø§Ù„Ù…Ø·ÙˆØ±ÙŠÙ†</h6>
                    <h2 class="fw-bold mb-0" id="statTotalDevs">...</h2>
                </div>
            </div>
            <div class="col-md-3">
                <div class="stat-card">
                    <i class="fas fa-server stat-icon text-danger"></i>
                    <h6 class="text-muted">Ø­Ø§Ù„Ø© Ø§Ù„Ø³ÙŠØ±ÙØ±</h6>
                    <h2 class="fw-bold mb-0 text-success" style="font-size: 1.2rem;">Stable 100%</h2>
                </div>
            </div>
        </div>

        <!-- Companies Table -->
        <div class="table-container">
            <div class="d-flex justify-content-between align-items-center mb-3">
                <h5 class="fw-bold">ğŸ“‚ Ù…Ù„ÙØ§Øª Ø§Ù„Ø´Ø±ÙƒØ§Øª (Ø§Ù„ÙˆØµÙˆÙ„ Ø§Ù„ÙƒØ§Ù…Ù„)</h5>
                <button class="btn btn-primary btn-sm" data-bs-toggle="modal" data-bs-target="#addCompanyModal"><i class="fas fa-plus"></i> Ø´Ø±ÙƒØ© Ø¬Ø¯ÙŠØ¯Ø©</button>
            </div>
            <div class="table-responsive">
                <table class="table table-hover">
                    <thead>
                        <tr>
                            <th>ID</th>
                            <th>Ø§Ø³Ù… Ø§Ù„Ø´Ø±ÙƒØ©</th>
                            <th>Ø§Ù„Ø¯ÙˆÙ„Ø©</th>
                            <th>Ø§Ù„Ù…Ø·ÙˆØ± Ø§Ù„Ù…Ø³Ø¤ÙˆÙ„</th>
                            <th>Ø§Ù„Ø±Ù‚Ù… Ø§Ù„Ø¶Ø±ÙŠØ¨ÙŠ</th>
                            <th>Ø§Ù„Ø­Ø§Ù„Ø©</th>
                            <th>Ø¥Ø¬Ø±Ø§Ø¡Ø§Øª</th>
                        </tr>
                    </thead>
                    <tbody id="companiesList"></tbody>
                </table>
            </div>
        </div>

    </div>

    <!-- Company File Modal (Ø§Ù„Ù…Ù„Ù Ø§Ù„Ø±Ù‚Ù…ÙŠ Ø§Ù„ÙƒØ§Ù…Ù„) -->
    <div class="modal fade" id="companyFileModal" tabindex="-1">
        <div class="modal-dialog modal-xl">
            <div class="modal-content">
                <div class="modal-header">
                    <div>
                        <h4 class="modal-title fw-bold" id="modalCompName">Ø§Ø³Ù… Ø§Ù„Ø´Ø±ÙƒØ©</h4>
                        <small class="text-white-50" id="modalCompId">ID: #000</small>
                    </div>
                    <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body p-0">
                    <!-- Tabs -->
                    <ul class="nav nav-tabs file-tabs px-3" role="tablist">
                        <li class="nav-item"><button class="nav-link active" data-bs-toggle="tab" data-bs-target="#tabInfo">ğŸ“Š Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø£Ø³Ø§Ø³ÙŠØ©</button></li>
                        <li class="nav-item"><button class="nav-link" data-bs-toggle="tab" data-bs-target="#tabKeys">ğŸ”‘ Ù…ÙØ§ØªÙŠØ­ Ø§Ù„Ø±Ø¨Ø· (Credentials)</button></li>
                        <li class="nav-item"><button class="nav-link" data-bs-toggle="tab" data-bs-target="#tabInvoices">ğŸ§¾ Ø³Ø¬Ù„ Ø§Ù„ÙÙˆØ§ØªÙŠØ±</button></li>
                        <li class="nav-item"><button class="nav-link" data-bs-toggle="tab" data-bs-target="#tabDev">ğŸ‘¨â€ğŸ’» Ø§Ù„Ù…Ø·ÙˆØ±</button></li>
                    </ul>
                    
                    <div class="tab-content p-4" style="min-height: 400px; background: #f8f9fa;">
                        <!-- Tab 1: Info -->
                        <div class="tab-pane fade show active" id="tabInfo">
                            <div class="row g-4">
                                <div class="col-md-6">
                                    <div class="bg-white p-3 rounded shadow-sm">
                                        <h6 class="text-muted mb-3">Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„ØªØ³Ø¬ÙŠÙ„</h6>
                                        <p><strong>Ø§Ù„Ø§Ø³Ù… Ø§Ù„Ø±Ø³Ù…ÙŠ:</strong> <span id="infoName"></span></p>
                                        <p><strong>Ø§Ù„Ø±Ù‚Ù… Ø§Ù„Ø¶Ø±ÙŠØ¨ÙŠ:</strong> <span id="infoTax" class="font-monospace"></span></p>
                                        <p><strong>Ø§Ù„Ø¯ÙˆÙ„Ø©:</strong> <span id="infoCountry"></span></p>
                                        <p><strong>ØªØ§Ø±ÙŠØ® Ø§Ù„Ø¥Ù†Ø´Ø§Ø¡:</strong> <span id="infoDate"></span></p>
                                    </div>
                                </div>
                                <div class="col-md-6">
                                    <div class="bg-white p-3 rounded shadow-sm">
                                        <h6 class="text-muted mb-3">Ø­Ø§Ù„Ø© Ø§Ù„Ù†Ø¸Ø§Ù…</h6>
                                        <div class="alert alert-success mb-0">
                                            <i class="fas fa-check-circle"></i> Ø§Ù„Ø´Ø±ÙƒØ© Ù†Ø´Ø·Ø© ÙˆØªØ¹Ù…Ù„ Ø¨Ø´ÙƒÙ„ Ø³Ù„ÙŠÙ….
                                        </div>
                                        <div class="mt-3">
                                            <label>ØªØºÙŠÙŠØ± Ø§Ù„Ø­Ø§Ù„Ø©:</label>
                                            <select class="form-select form-select-sm mt-1">
                                                <option value="active">Ù†Ø´Ø· (Active)</option>
                                                <option value="suspended">Ù…ÙˆÙ‚ÙˆÙ (Suspended)</option>
                                            </select>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Tab 2: Credentials (Ø§Ù„Ù…ÙƒØ§Ù† Ø§Ù„Ø­Ø³Ø§Ø³) -->
                        <div class="tab-pane fade" id="tabKeys">
                            <div class="alert alert-warning border-warning">
                                <i class="fas fa-exclamation-triangle"></i> <strong>ØªØ­Ø°ÙŠØ± Ø£Ù…Ù†ÙŠ:</strong> Ù‡Ø°Ù‡ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø­Ø³Ø§Ø³Ø© Ø¬Ø¯Ø§Ù‹. Ù„Ø§ ØªØ´Ø§Ø±ÙƒÙ‡Ø§ Ù…Ø¹ Ø£ÙŠ Ø·Ø±Ù Ø«Ø§Ù„Ø«.
                            </div>
                            
                            <div id="egyptCredentials" class="d-none">
                                <h6 class="fw-bold text-dark mb-3">ğŸ‡ªğŸ‡¬ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø±Ø¨Ø· Ù…Ø¹ Ø§Ù„Ø¶Ø±Ø§Ø¦Ø¨ Ø§Ù„Ù…ØµØ±ÙŠØ© (ETA)</h6>
                                <div class="cred-box">
                                    <span class="cred-label">Client ID</span>
                                    <span id="credEtaId">...</span>
                                </div>
                                <div class="cred-box">
                                    <span class="cred-label">Client Secret</span>
                                    <span id="credEtaSecret">...</span>
                                </div>
                            </div>

                            <div id="saudiCredentials" class="d-none">
                                <h6 class="fw-bold text-dark mb-3">ğŸ‡¸ğŸ‡¦ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø±Ø¨Ø· Ù…Ø¹ Ø§Ù„Ø²ÙƒØ§Ø© ÙˆØ§Ù„Ø¯Ø®Ù„ (ZATCA)</h6>
                                <div class="cred-box">
                                    <span class="cred-label">OTP Code</span>
                                    <span id="credZatcaOtp">...</span>
                                </div>
                                <div class="cred-box">
                                    <span class="cred-label">CSID (Cryptographic Stamp ID)</span>
                                    <span class="text-white-50">Generated automatically upon connection</span>
                                </div>
                            </div>

                            <div class="mt-3 text-end">
                                <button class="btn btn-dark btn-sm"><i class="fas fa-sync"></i> Ø¥Ø¹Ø§Ø¯Ø© ØªÙˆÙ„ÙŠØ¯ Ø§Ù„Ù…ÙØ§ØªÙŠØ­</button>
                            </div>
                        </div>

                        <!-- Tab 3: Invoices -->
                        <div class="tab-pane fade" id="tabInvoices">
                            <div class="table-responsive bg-white rounded shadow-sm">
                                <table class="table table-sm mb-0">
                                    <thead class="table-light">
                                        <tr><th>Ø±Ù‚Ù… Ø§Ù„ÙØ§ØªÙˆØ±Ø©</th><th>Ø§Ù„Ù‚ÙŠÙ…Ø©</th><th>Ø§Ù„Ø­Ø§Ù„Ø©</th><th>UUID</th></tr>
                                    </thead>
                                    <tbody id="invoicesListModal"></tbody>
                                </table>
                            </div>
                        </div>

                        <!-- Tab 4: Developer -->
                        <div class="tab-pane fade" id="tabDev">
                            <div class="d-flex align-items-center p-4 bg-white rounded shadow-sm">
                                <div class="bg-light rounded-circle p-3 text-primary">
                                    <i class="fas fa-user-tie fa-2x"></i>
                                </div>
                                <div class="ms-3">
                                    <h5 class="mb-1 fw-bold" id="devNameModal">Ø§Ø³Ù… Ø§Ù„Ù…Ø·ÙˆØ±</h5>
                                    <p class="mb-0 text-muted" id="devEmailModal">email@example.com</p>
                                    <p class="mb-0 text-muted" id="devPhoneModal">05xxxxxxxx</p>
                                </div>
                                <a href="#" class="btn btn-outline-primary ms-auto">Ø¹Ø±Ø¶ Ù…Ù„Ù Ø§Ù„Ù…Ø·ÙˆØ± Ø§Ù„ÙƒØ§Ù…Ù„</a>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Modal Ø¥Ø¶Ø§ÙØ© Ø´Ø±ÙƒØ© (Ù†ÙØ³ Ø§Ù„Ù‚Ø¯ÙŠÙ…) -->
    <div class="modal fade" id="addCompanyModal" tabindex="-1">
        <div class="modal-dialog">
            <div class="modal-content">
                <form action="/add-company" method="POST">
                    <div class="modal-header bg-primary text-white">
                        <h5 class="modal-title">Ø¥Ø¶Ø§ÙØ© Ø´Ø±ÙƒØ© Ø¬Ø¯ÙŠØ¯Ø©</h5>
                        <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                    </div>
                    <div class="modal-body">
                        <div class="mb-3">
                            <label>Ø§Ø³Ù… Ø§Ù„Ø´Ø±ÙƒØ©</label>
                            <input type="text" name="name" class="form-control" required>
                        </div>
                        <div class="mb-3">
                            <label>Ø§Ù„Ø±Ù‚Ù… Ø§Ù„Ø¶Ø±ÙŠØ¨ÙŠ</label>
                            <input type="text" name="tax_id" class="form-control" required>
                        </div>
                        <div class="mb-3">
                            <label>Ø§Ù„Ø¯ÙˆÙ„Ø©</label>
                            <select name="country_code" class="form-select">
                                <option value="EG">Ù…ØµØ± (ETA)</option>
                                <option value="SA">Ø§Ù„Ø³Ø¹ÙˆØ¯ÙŠØ© (ZATCA)</option>
                            </select>
                        </div>
                    </div>
                    <div class="modal-footer">
                        <button type="submit" class="btn btn-primary">Ø­ÙØ¸</button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        // Ø¬Ù„Ø¨ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø­ÙŠØ©
        async function fetchDashboardData() {
            try {
                const res = await fetch('/api/admin/dashboard-stats');
                const data = await res.json();
                
                // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¹Ø¯Ø§Ø¯Ø§Øª
                document.getElementById('statTotalInvoices').innerText = data.stats.invoices.total;
                document.getElementById('statTotalCompanies').innerText = data.stats.totalCompanies;
                document.getElementById('statTotalDevs').innerText = data.stats.totalDevs;
                
                document.getElementById('lastUpdate').innerText = 'ØªØ­Ø¯ÙŠØ«: ' + new Date().toLocaleTimeString('ar-EG');

                // ØªØ­Ø¯ÙŠØ« Ø¬Ø¯ÙˆÙ„ Ø§Ù„Ø´Ø±ÙƒØ§Øª
                const tbody = document.getElementById('companiesList');
                tbody.innerHTML = '';
                
                // Ù…Ù„Ø§Ø­Ø¸Ø©: Ù‡Ù†Ø§ Ù†Ø­ØªØ§Ø¬ Ù„Ø¬Ù„Ø¨ ÙƒÙ„ Ø§Ù„Ø´Ø±ÙƒØ§Øª ÙˆÙ„ÙŠØ³ ÙÙ‚Ø· Ø§Ù„Ù€ recent
                // ÙÙŠ Ø§Ù„ØªØ·Ø¨ÙŠÙ‚ Ø§Ù„Ø­Ù‚ÙŠÙ‚ÙŠ Ø³Ù†Ø³ØªØ®Ø¯Ù… PaginationØŒ Ù„ÙƒÙ† Ù‡Ù†Ø§ Ù„Ù„Ø¹Ø±Ø¶:
                data.recentCompanies.forEach(c => {
                    const flag = c.country_code === 'EG' ? 'ğŸ‡ªğŸ‡¬' : 'ğŸ‡¸ğŸ‡¦';
                    const statusDot = '<span class="status-dot dot-success"></span>';
                    
                    tbody.innerHTML += `
                        <tr style="cursor:pointer" onclick="openCompanyFile(${c.id})">
                            <td class="text-muted">#${c.id}</td>
                            <td class="fw-bold text-primary">${c.name}</td>
                            <td>${flag} ${c.country_code}</td>
                            <td><span class="badge bg-light text-dark border">ØªØ­Ù…ÙŠÙ„...</span></td>
                            <td class="font-monospace">${c.tax_id}</td>
                            <td>${statusDot} Active</td>
                            <td>
                                <button class="btn btn-sm btn-light text-primary"><i class="fas fa-folder-open"></i> ÙØªØ­ Ø§Ù„Ù…Ù„Ù</button>
                            </td>
                        </tr>
                    `;
                });

            } catch (err) { console.error(err); }
        }

        // ÙØªØ­ Ù…Ù„Ù Ø§Ù„Ø´Ø±ÙƒØ© (Ø§Ù„Ù…ÙŠØ²Ø© Ø§Ù„Ø£Ø³Ø§Ø³ÙŠØ©)
        async function openCompanyFile(id) {
            // Ø¥Ø¸Ù‡Ø§Ø± Ø§Ù„Ù…ÙˆØ¯Ø§Ù„ ÙÙˆØ±Ø§Ù‹ Ù…Ø¹ ØªØ­Ù…ÙŠÙ„
            const modal = new bootstrap.Modal(document.getElementById('companyFileModal'));
            modal.show();

            try {
                const res = await fetch(`/api/admin/company-file/${id}`);
                const data = await res.json();
                const info = data.info;

                // 1. ØªØ¹Ø¨Ø¦Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø£Ø³Ø§Ø³ÙŠØ©
                document.getElementById('modalCompName').innerText = info.name;
                document.getElementById('modalCompId').innerText = `ID: #${info.id} | API Secret: ${info.api_secret}`;
                document.getElementById('infoName').innerText = info.name;
                document.getElementById('infoTax').innerText = info.tax_id;
                document.getElementById('infoCountry').innerText = info.country_code === 'EG' ? 'Ù…ØµØ±' : 'Ø§Ù„Ø³Ø¹ÙˆØ¯ÙŠØ©';
                document.getElementById('infoDate').innerText = new Date(info.created_at).toLocaleDateString();

                // 2. ØªØ¹Ø¨Ø¦Ø© Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø§Ø¹ØªÙ…Ø§Ø¯ Ø­Ø³Ø¨ Ø§Ù„Ø¯ÙˆÙ„Ø©
                const creds = data.credentials;
                if (info.country_code === 'EG') {
                    document.getElementById('egyptCredentials').classList.remove('d-none');
                    document.getElementById('saudiCredentials').classList.add('d-none');
                    document.getElementById('credEtaId').innerText = creds.id || 'ØºÙŠØ± Ù…Ø¯Ø®Ù„';
                    document.getElementById('credEtaSecret').innerText = creds.secret || 'ØºÙŠØ± Ù…Ø¯Ø®Ù„';
                } else {
                    document.getElementById('egyptCredentials').classList.add('d-none');
                    document.getElementById('saudiCredentials').classList.remove('d-none');
                    document.getElementById('credZatcaOtp').innerText = creds.otp || 'ØºÙŠØ± Ù…Ø¯Ø®Ù„';
                }

                // 3. ØªØ¹Ø¨Ø¦Ø© Ø§Ù„ÙÙˆØ§ØªÙŠØ±
                const invBody = document.getElementById('invoicesListModal');
                invBody.innerHTML = '';
                if(data.invoices.length === 0) invBody.innerHTML = '<tr><td colspan="4" class="text-center py-3">Ù„Ø§ ØªÙˆØ¬Ø¯ ÙÙˆØ§ØªÙŠØ±</td></tr>';
                data.invoices.forEach(inv => {
                    invBody.innerHTML += `
                        <tr>
                            <td>${inv.internal_id}</td>
                            <td>${inv.total_amount}</td>
                            <td><span class="badge ${inv.status==='submitted'?'bg-success':'bg-danger'}">${inv.status}</span></td>
                            <td class="small text-muted">${inv.gov_uuid || '-'}</td>
                        </tr>
                    `;
                });

                // 4. Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø·ÙˆØ±
                document.getElementById('devNameModal').innerText = info.dev_name || 'Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù†Ø¸Ø§Ù… (Ø£Ø¯Ù…Ù†)';
                document.getElementById('devEmailModal').innerText = info.dev_email || '-';
                document.getElementById('devPhoneModal').innerText = info.dev_phone || '-';

            } catch (err) {
                alert("ÙØ´Ù„ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù…Ù„Ù: " + err.message);
            }
        }

        // ØªØ´ØºÙŠÙ„ Ø¹Ù†Ø¯ Ø§Ù„Ø¨Ø¯Ø¡
        fetchDashboardData();
        setInterval(fetchDashboardData, 10000);
    </script>
</body>
</html>
