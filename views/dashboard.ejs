<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <title>Nerve Center | MetaConnect</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.rtl.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Tajawal:wght@400;500;700;800&display=swap" rel="stylesheet">
    
    <style>
        body { font-family: 'Tajawal', sans-serif; background: #f4f7fa; overflow-x: hidden; }
        
        /* Sidebar */
        .sidebar { width: 250px; height: 100vh; background: #1a202c; color: white; position: fixed; top: 0; right: 0; padding: 20px; z-index: 1000; }
        .sidebar h4 { font-weight: 800; margin-bottom: 40px; letter-spacing: 1px; color: #fff; text-align: center; }
        .sidebar h4 span { color: #3182ce; }
        .nav-link { color: #a0aec0; padding: 12px 15px; border-radius: 8px; transition: 0.3s; margin-bottom: 5px; display: flex; align-items: center; cursor: pointer; }
        .nav-link i { width: 25px; font-size: 1.1rem; margin-left: 10px; }
        .nav-link:hover, .nav-link.active { background: #2d3748; color: white; transform: translateX(-5px); }
        
        /* Main Content */
        .main-content { margin-right: 250px; padding: 30px; }
        
        /* Sections Logic */
        .content-section { display: none; }
        .content-section.active { display: block; animation: fadeIn 0.3s; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }

        /* Cards */
        .stat-card { background: white; padding: 25px; border-radius: 15px; box-shadow: 0 4px 20px rgba(0,0,0,0.03); position: relative; overflow: hidden; transition: transform 0.3s; margin-bottom: 20px; }
        .stat-card:hover { transform: translateY(-5px); }
        .stat-icon { position: absolute; left: 20px; top: 50%; transform: translateY(-50%); font-size: 3.5rem; opacity: 0.05; }
        
        /* Tables */
        .table-container { background: white; border-radius: 15px; box-shadow: 0 4px 20px rgba(0,0,0,0.03); padding: 20px; overflow: hidden; }
        .table thead th { background: #f8f9fa; border: none; color: #718096; font-weight: 600; padding: 15px; }
        .table tbody td { vertical-align: middle; padding: 15px; }
        .table tbody tr { transition: background 0.2s; }
        .table tbody tr:hover { background-color: #f8fafc; }
        
        /* Shipping Section Styles */
        .shipping-card { border-left: 4px solid #ed8936; }
        .shipping-status { padding: 5px 10px; border-radius: 15px; font-size: 0.8rem; font-weight: bold; }
        .status-pending { background: #feebc8; color: #c05621; }
        .status-shipped { background: #c6f6d5; color: #276749; }
    </style>
</head>
<body>

    <!-- Sidebar -->
    <div class="sidebar">
        <h4>Meta<span>Connect</span></h4>
        <nav class="nav flex-column">
            <a class="nav-link active" onclick="switchSection('overview', this)"><i class="fas fa-chart-pie"></i> Ù†Ø¸Ø±Ø© Ø¹Ø§Ù…Ø©</a>
            <a class="nav-link" onclick="switchSection('shipping', this)"><i class="fas fa-truck"></i> Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø´Ø­Ù† <span class="badge bg-warning ms-auto">Ø¬Ø¯ÙŠØ¯</span></a>
            <a class="nav-link" onclick="switchSection('companies', this)"><i class="fas fa-building"></i> Ù…Ù„ÙØ§Øª Ø§Ù„Ø´Ø±ÙƒØ§Øª</a>
            <a class="nav-link" onclick="switchSection('developers', this)"><i class="fas fa-users-cog"></i> Ø§Ù„Ù…Ø·ÙˆØ±ÙŠÙ†</a>
            <a class="nav-link" href="/admin/support"><i class="fas fa-headset"></i> Ø§Ù„Ø¯Ø¹Ù… Ø§Ù„ÙÙ†ÙŠ</a>
            <div style="margin-top: auto; padding-top: 50px;">
                <a class="nav-link text-danger" href="/logout"><i class="fas fa-power-off"></i> ØªØ³Ø¬ÙŠÙ„ Ø®Ø±ÙˆØ¬</a>
            </div>
        </nav>
    </div>

    <!-- Main Content -->
    <div class="main-content">
        
        <!-- Header -->
        <div class="d-flex justify-content-between align-items-center mb-4">
            <h3 class="fw-bold text-dark" id="pageTitle">Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ… Ø§Ù„Ù…Ø±ÙƒØ²ÙŠØ©</h3>
            <div class="d-flex align-items-center gap-2">
                <span class="badge bg-success px-3 py-2 rounded-pill"><i class="fas fa-wifi"></i> Ù…ØªØµÙ„</span>
                <span class="text-muted small" id="lastUpdate">ØªØ­Ø¯ÙŠØ«: Ø§Ù„Ø¢Ù†</span>
            </div>
        </div>

        <!-- SECTION 1: Overview -->
        <div id="overview" class="content-section active">
            <div class="row g-4 mb-4">
                <div class="col-md-3">
                    <div class="stat-card">
                        <i class="fas fa-file-invoice-dollar stat-icon text-primary"></i>
                        <h6 class="text-muted">Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„ÙÙˆØ§ØªÙŠØ±</h6>
                        <h2 class="fw-bold mb-0" id="statTotalInvoices">0</h2>
                    </div>
                </div>
                <div class="col-md-3">
                    <div class="stat-card">
                        <i class="fas fa-building stat-icon text-warning"></i>
                        <h6 class="text-muted">Ø§Ù„Ø´Ø±ÙƒØ§Øª Ø§Ù„Ù…Ø³Ø¬Ù„Ø©</h6>
                        <h2 class="fw-bold mb-0" id="statTotalCompanies">0</h2>
                    </div>
                </div>
                <div class="col-md-3">
                    <div class="stat-card">
                        <i class="fas fa-users stat-icon text-success"></i>
                        <h6 class="text-muted">Ø§Ù„Ù…Ø·ÙˆØ±ÙŠÙ†</h6>
                        <h2 class="fw-bold mb-0" id="statTotalDevs">0</h2>
                    </div>
                </div>
                <div class="col-md-3">
                    <div class="stat-card">
                        <i class="fas fa-shipping-fast stat-icon text-info"></i>
                        <h6 class="text-muted">Ø·Ù„Ø¨Ø§Øª Ø§Ù„Ø´Ø­Ù†</h6>
                        <h2 class="fw-bold mb-0">0</h2>
                    </div>
                </div>
            </div>
            
            <!-- Quick Companies Table -->
            <div class="table-container">
                <h5 class="fw-bold mb-3">ğŸš€ Ø£Ø­Ø¯Ø« Ø§Ù„Ù†Ø´Ø§Ø·Ø§Øª</h5>
                <table class="table">
                    <thead><tr><th>Ø§Ù„Ø´Ø±ÙƒØ©</th><th>Ø§Ù„Ø­Ø§Ù„Ø©</th><th>Ø§Ù„ÙˆÙ‚Øª</th></tr></thead>
                    <tbody id="recentActivity"></tbody>
                </table>
            </div>
        </div>

        <!-- SECTION 2: Shipping (Ø¬Ø¯ÙŠØ¯) -->
        <div id="shipping" class="content-section">
            <div class="row g-4 mb-4">
                <div class="col-md-4">
                    <div class="stat-card shipping-card">
                        <h6 class="text-muted">Ù‚ÙŠØ¯ Ø§Ù„ØªØ¬Ù‡ÙŠØ²</h6>
                        <h2 class="fw-bold text-warning">0</h2>
                    </div>
                </div>
                <div class="col-md-4">
                    <div class="stat-card shipping-card" style="border-color: #48bb78;">
                        <h6 class="text-muted">ØªÙ… Ø§Ù„Ø´Ø­Ù†</h6>
                        <h2 class="fw-bold text-success">0</h2>
                    </div>
                </div>
                <div class="col-md-4">
                    <div class="stat-card shipping-card" style="border-color: #e53e3e;">
                        <h6 class="text-muted">Ù…Ø±ØªØ¬Ø¹Ø§Øª</h6>
                        <h2 class="fw-bold text-danger">0</h2>
                    </div>
                </div>
            </div>

            <div class="table-container">
                <div class="d-flex justify-content-between align-items-center mb-3">
                    <h5 class="fw-bold">ğŸ“¦ Ø³Ø¬Ù„ Ø§Ù„Ø´Ø­Ù†Ø§Øª</h5>
                    <button class="btn btn-primary btn-sm"><i class="fas fa-plus"></i> Ø´Ø­Ù†Ø© Ø¬Ø¯ÙŠØ¯Ø©</button>
                </div>
                <table class="table table-hover">
                    <thead>
                        <tr>
                            <th>Ø±Ù‚Ù… Ø§Ù„Ø´Ø­Ù†Ø©</th>
                            <th>Ø§Ù„Ø¹Ù…ÙŠÙ„</th>
                            <th>Ø§Ù„ÙˆØ¬Ù‡Ø©</th>
                            <th>Ø§Ù„Ø­Ø§Ù„Ø©</th>
                            <th>ØªØ§Ø±ÙŠØ® Ø§Ù„Ø·Ù„Ø¨</th>
                            <th>Ø¥Ø¬Ø±Ø§Ø¡Ø§Øª</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td>#SH-1023</td>
                            <td>Ø´Ø±ÙƒØ© Ø§Ù„Ø£ÙÙ‚</td>
                            <td>Ø§Ù„Ø±ÙŠØ§Ø¶ØŒ Ø§Ù„Ø³Ø¹ÙˆØ¯ÙŠØ©</td>
                            <td><span class="shipping-status status-pending">Ù‚ÙŠØ¯ Ø§Ù„Ø§Ù†ØªØ¸Ø§Ø±</span></td>
                            <td>2025-12-01</td>
                            <td><button class="btn btn-sm btn-light"><i class="fas fa-edit"></i></button></td>
                        </tr>
                        <!-- ÙŠÙ…ÙƒÙ† Ù…Ù„Ø¤Ù‡Ø§ Ø¯ÙŠÙ†Ø§Ù…ÙŠÙƒÙŠØ§Ù‹ Ù„Ø§Ø­Ù‚Ø§Ù‹ -->
                    </tbody>
                </table>
            </div>
        </div>

        <!-- SECTION 3: Companies Files -->
        <div id="companies" class="content-section">
            <div class="table-container">
                <div class="d-flex justify-content-between align-items-center mb-3">
                    <h5 class="fw-bold">ğŸ“‚ Ø£Ø±Ø´ÙŠÙ Ø§Ù„Ø´Ø±ÙƒØ§Øª Ø§Ù„ÙƒØ§Ù…Ù„</h5>
                    <input type="text" class="form-control w-25" placeholder="Ø¨Ø­Ø« Ø¹Ù† Ø´Ø±ÙƒØ©..." onkeyup="filterCompanies(this.value)">
                </div>
                <div class="table-responsive">
                    <table class="table table-hover">
                        <thead>
                            <tr>
                                <th>ID</th>
                                <th>Ø§Ø³Ù… Ø§Ù„Ø´Ø±ÙƒØ©</th>
                                <th>Ø§Ù„Ø¯ÙˆÙ„Ø©</th>
                                <th>Ø§Ù„Ø±Ù‚Ù… Ø§Ù„Ø¶Ø±ÙŠØ¨ÙŠ</th>
                                <th>Ø§Ù„Ø­Ø§Ù„Ø©</th>
                                <th>ÙØªØ­ Ø§Ù„Ù…Ù„Ù</th>
                            </tr>
                        </thead>
                        <tbody id="companiesListFull"></tbody>
                    </table>
                </div>
            </div>
        </div>

        <!-- SECTION 4: Developers -->
        <div id="developers" class="content-section">
            <div class="table-container">
                <h5 class="fw-bold mb-3">ğŸ‘¨â€ğŸ’» Ø§Ù„Ù…Ø·ÙˆØ±ÙŠÙ† ÙˆØ´Ø±ÙƒØ§Øª Ø§Ù„Ø¨Ø±Ù…Ø¬Ø©</h5>
                <div class="row" id="devsGrid">
                    <!-- Ø³ÙŠØªÙ… Ù…Ù„Ø¤Ù‡Ø§ Ø¨Ø§Ù„ÙƒÙˆØ¯ -->
                </div>
            </div>
        </div>

    </div>

    <!-- Company File Modal (Ø§Ù„Ù†Ø§ÙØ°Ø© Ø§Ù„Ù…Ù†Ø¨Ø«Ù‚Ø© Ù„Ù„Ù…Ù„Ù) -->
    <div class="modal fade" id="companyFileModal" tabindex="-1">
        <div class="modal-dialog modal-xl">
            <div class="modal-content border-0 shadow-lg">
                <div class="modal-header bg-dark text-white">
                    <h5 class="modal-title"><i class="fas fa-folder-open me-2"></i> Ù…Ù„Ù Ø§Ù„Ø´Ø±ÙƒØ© Ø§Ù„Ø±Ù‚Ù…ÙŠ</h5>
                    <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body p-4" id="modalContent">
                    <div class="text-center py-5"><i class="fas fa-spinner fa-spin fa-3x"></i><p class="mt-2">Ø¬Ø§Ø±ÙŠ Ø¬Ù„Ø¨ Ø§Ù„Ù…Ù„Ù...</p></div>
                </div>
            </div>
        </div>
    </div>

    <!-- Developer File Modal -->
    <div class="modal fade" id="devFileModal" tabindex="-1">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header bg-primary text-white">
                    <h5 class="modal-title">Ù…Ù„Ù Ø§Ù„Ù…Ø·ÙˆØ±</h5>
                    <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body" id="devModalContent">
                    <!-- Ù…Ø­ØªÙˆÙ‰ Ø§Ù„Ù…Ø·ÙˆØ± -->
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        
        // 1. Ø§Ù„ØªØ¨Ø¯ÙŠÙ„ Ø¨ÙŠÙ† Ø§Ù„Ø£Ù‚Ø³Ø§Ù…
        function switchSection(sectionId, linkElement) {
            // Ø¥Ø®ÙØ§Ø¡ ÙƒÙ„ Ø§Ù„Ø£Ù‚Ø³Ø§Ù…
            document.querySelectorAll('.content-section').forEach(el => el.classList.remove('active'));
            // Ø¥Ø¸Ù‡Ø§Ø± Ø§Ù„Ù‚Ø³Ù… Ø§Ù„Ù…Ø·Ù„ÙˆØ¨
            document.getElementById(sectionId).classList.add('active');
            
            // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø¬Ø§Ù†Ø¨ÙŠØ©
            document.querySelectorAll('.nav-link').forEach(el => el.classList.remove('active'));
            if(linkElement) linkElement.classList.add('active');

            // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¹Ù†ÙˆØ§Ù†
            const titles = {
                'overview': 'Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ… Ø§Ù„Ù…Ø±ÙƒØ²ÙŠØ©',
                'shipping': 'Ø¥Ø¯Ø§Ø±Ø© Ø¹Ù…Ù„ÙŠØ§Øª Ø§Ù„Ø´Ø­Ù†',
                'companies': 'Ø£Ø±Ø´ÙŠÙ Ø§Ù„Ø´Ø±ÙƒØ§Øª',
                'developers': 'Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…Ø·ÙˆØ±ÙŠÙ†'
            };
            document.getElementById('pageTitle').innerText = titles[sectionId];
        }

        // 2. Ø¬Ù„Ø¨ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø£Ø³Ø§Ø³ÙŠØ©
        async function fetchDashboardData() {
            try {
                const res = await fetch('/api/admin/dashboard-stats');
                const data = await res.json();

                // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¹Ø¯Ø§Ø¯Ø§Øª
                document.getElementById('statTotalInvoices').innerText = data.stats.invoices.total;
                document.getElementById('statTotalCompanies').innerText = data.stats.totalCompanies;
                document.getElementById('statTotalDevs').innerText = data.stats.totalDevs;

                // ØªØ­Ø¯ÙŠØ« Ø¬Ø¯ÙˆÙ„ Ø§Ù„Ø´Ø±ÙƒØ§Øª (Ø§Ù„Ù‚Ø³Ù… 3)
                const tbody = document.getElementById('companiesListFull');
                tbody.innerHTML = '';
                data.recentCompanies.forEach(c => { // ÙÙŠ Ø§Ù„ÙˆØ§Ù‚Ø¹ ÙŠØ¬Ø¨ Ø¬Ù„Ø¨ Ø§Ù„ÙƒÙ„ØŒ Ù‡Ù†Ø§ Ù†Ø³ØªØ®Ø¯Ù… recent ÙƒÙ…Ø«Ø§Ù„
                    const flag = c.country_code === 'EG' ? 'ğŸ‡ªğŸ‡¬' : 'ğŸ‡¸ğŸ‡¦';
                    tbody.innerHTML += `
                        <tr onclick="openCompanyFile(${c.id})" style="cursor:pointer">
                            <td>#${c.id}</td>
                            <td class="fw-bold">${c.name}</td>
                            <td>${flag} ${c.country_code}</td>
                            <td class="font-monospace">${c.tax_id}</td>
                            <td><span class="badge bg-success">Ù†Ø´Ø·</span></td>
                            <td><button class="btn btn-sm btn-outline-primary">Ø¹Ø±Ø¶ Ø§Ù„Ù…Ù„Ù</button></td>
                        </tr>
                    `;
                });

                // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ù…Ø·ÙˆØ±ÙŠÙ† (Ø§Ù„Ù‚Ø³Ù… 4)
                const devGrid = document.getElementById('devsGrid');
                devGrid.innerHTML = '';
                data.recentDevs.forEach(d => {
                    devGrid.innerHTML += `
                        <div class="col-md-4 mb-3">
                            <div class="card h-100 shadow-sm" onclick="openDevFile(${d.id})" style="cursor:pointer">
                                <div class="card-body text-center">
                                    <div class="bg-light rounded-circle mx-auto mb-3 d-flex align-items-center justify-content-center text-primary fw-bold" style="width:60px; height:60px; font-size:1.5rem">
                                        ${d.name.charAt(0).toUpperCase()}
                                    </div>
                                    <h5 class="fw-bold">${d.name}</h5>
                                    <p class="text-muted small">${d.email}</p>
                                    <span class="badge bg-info text-dark">Wallet: $${d.wallet_balance}</span>
                                </div>
                            </div>
                        </div>
                    `;
                });

            } catch (e) { console.error(e); }
        }

        // 3. ÙØªØ­ Ù…Ù„Ù Ø§Ù„Ø´Ø±ÙƒØ© (Ø§Ù„ØªÙØ§ØµÙŠÙ„ Ø§Ù„ÙƒØ§Ù…Ù„Ø©)
        async function openCompanyFile(id) {
            const modal = new bootstrap.Modal(document.getElementById('companyFileModal'));
            modal.show();
            
            const contentDiv = document.getElementById('modalContent');
            contentDiv.innerHTML = '<div class="text-center py-5"><i class="fas fa-spinner fa-spin fa-3x"></i></div>';

            try {
                const res = await fetch(`/api/admin/company-file/${id}`);
                const data = await res.json();
                const info = data.info;
                const creds = data.credentials;

                let credsHtml = '';
                if (info.country_code === 'EG') {
                    credsHtml = `
                        <div class="alert alert-info">
                            <h6>ğŸ‡ªğŸ‡¬ Ù…ÙØ§ØªÙŠØ­ Ø§Ù„Ø¶Ø±Ø§Ø¦Ø¨ Ø§Ù„Ù…ØµØ±ÙŠØ© (ETA)</h6>
                            <p class="mb-1"><strong>Client ID:</strong> de class="bg-white px-2 py-1 rounded">${creds.id || 'ØºÙŠØ± Ù…ØªÙˆÙØ±'}</code></p>
                            <p class="mb-0"><strong>Client Secret:</strong> de class="bg-white px-2 py-1 rounded">${creds.secret || 'ØºÙŠØ± Ù…ØªÙˆÙØ±'}</code></p>
                        </div>`;
                } else {
                    credsHtml = `
                        <div class="alert alert-success">
                            <h6>ğŸ‡¸ğŸ‡¦ Ù…ÙØ§ØªÙŠØ­ Ø§Ù„Ø²ÙƒØ§Ø© ÙˆØ§Ù„Ø¯Ø®Ù„ (ZATCA)</h6>
                            <p class="mb-0"><strong>OTP Code:</strong> de class="bg-white px-2 py-1 rounded">${creds.otp || 'ØºÙŠØ± Ù…ØªÙˆÙØ±'}</code></p>
                        </div>`;
                }

                contentDiv.innerHTML = `
                    <div class="row">
                        <div class="col-md-6">
                            <h5 class="fw-bold border-bottom pb-2">Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ø´Ø±ÙƒØ©</h5>
                            <p><strong>Ø§Ù„Ø§Ø³Ù…:</strong> ${info.name}</p>
                            <p><strong>Ø§Ù„Ø±Ù‚Ù… Ø§Ù„Ø¶Ø±ÙŠØ¨ÙŠ:</strong> ${info.tax_id}</p>
                            <p><strong>Ø§Ù„Ø¯ÙˆÙ„Ø©:</strong> ${info.country_code === 'EG' ? 'Ù…ØµØ±' : 'Ø§Ù„Ø³Ø¹ÙˆØ¯ÙŠØ©'}</p>
                        </div>
                        <div class="col-md-6">
                            <h5 class="fw-bold border-bottom pb-2">Ø§Ù„Ù…Ø·ÙˆØ± Ø§Ù„Ù…Ø³Ø¤ÙˆÙ„</h5>
                            <p><strong>Ø§Ù„Ø§Ø³Ù…:</strong> ${info.dev_name || 'ØºÙŠØ± Ù…Ø³Ù†Ø¯'}</p>
                            <p><strong>Ø§Ù„Ù‡Ø§ØªÙ:</strong> ${info.dev_phone || '-'}</p>
                            <p><strong>Ø§Ù„Ø¥ÙŠÙ…ÙŠÙ„:</strong> ${info.dev_email || '-'}</p>
                        </div>
                    </div>
                    <div class="mt-4">
                        <h5 class="fw-bold border-bottom pb-2">ğŸ” Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø±Ø¨Ø· (Credentials)</h5>
                        ${credsHtml}
                    </div>
                    <div class="mt-4">
                        <h5 class="fw-bold border-bottom pb-2">ğŸ§¾ Ø¢Ø®Ø± Ø§Ù„ÙÙˆØ§ØªÙŠØ±</h5>
                        <table class="table table-sm table-bordered">
                            <thead><tr><th>#</th><th>Ø§Ù„Ù…Ø¨Ù„Øº</th><th>Ø§Ù„Ø­Ø§Ù„Ø©</th></tr></thead>
                            <tbody>
                                ${data.invoices.map(inv => `
                                    <tr>
                                        <td>${inv.internal_id}</td>
                                        <td>${inv.total_amount}</td>
                                        <td><span class="badge ${inv.status === 'submitted' ? 'bg-success' : 'bg-danger'}">${inv.status}</span></td>
                                    </tr>
                                `).join('')}
                            </tbody>
                        </table>
                    </div>
                `;

            } catch (e) {
                contentDiv.innerHTML = `<div class="alert alert-danger">Ø®Ø·Ø£ ÙÙŠ Ø¬Ù„Ø¨ Ø§Ù„Ù…Ù„Ù: ${e.message}</div>`;
            }
        }

        // 4. ÙØªØ­ Ù…Ù„Ù Ø§Ù„Ù…Ø·ÙˆØ±
        async function openDevFile(id) {
            const modal = new bootstrap.Modal(document.getElementById('devFileModal'));
            modal.show();
            const content = document.getElementById('devModalContent');
            
            try {
                const res = await fetch(`/api/admin/developer-file/${id}`);
                const data = await res.json();
                content.innerHTML = `
                    <div class="text-center mb-4">
                        <h4>${data.profile.name}</h4>
                        <p class="text-muted">${data.profile.email}</p>
                        <h3>Wallet: $${data.profile.wallet_balance}</h3>
                    </div>
                    <h6>Ø§Ù„Ø´Ø±ÙƒØ§Øª Ø§Ù„ØªØ§Ø¨Ø¹Ø©:</h6>
                    <ul class="list-group mb-3">
                        ${data.companies.map(c => `<li class="list-group-item">${c.name} (${c.country_code})</li>`).join('')}
                    </ul>
                `;
            } catch (e) { content.innerHTML = 'Error loading data'; }
        }

        // ØªØ´ØºÙŠÙ„ Ø£ÙˆÙ„ÙŠ
        fetchDashboardData();
        setInterval(fetchDashboardData, 10000);

    </script>
</body>
</html>
