<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <title>Ù„ÙˆØ­Ø© Ø§Ù„Ù…Ø·ÙˆØ± | MetaConnect</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <!-- Bootstrap 5 & Icons -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.rtl.min.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.1/font/bootstrap-icons.css">
    <!-- Google Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Outfit:wght@300;500;700&family=Tajawal:wght@300;400;500;700;800&display=swap" rel="stylesheet">
    
    <style>
        :root {
            --primary-color: #2563eb;
            --secondary-color: #475569;
            --accent-color: #f59e0b;
            --success-color: #10b981;
            --bg-color: #f8fafc;
            --card-bg: #ffffff;
        }

        body { 
            font-family: 'Tajawal', sans-serif; 
            background-color: var(--bg-color); 
            color: #1e293b;
        }

        /* Navbar */
        .navbar {
            background: linear-gradient(135deg, #1e293b, #0f172a) !important;
            box-shadow: 0 4px 20px rgba(0,0,0,0.1);
            padding: 1rem 0;
        }
        .navbar-brand {
            font-weight: 800;
            letter-spacing: 0.5px;
            font-size: 1.4rem;
        }

        /* Cards */
        .card {
            border: none;
            border-radius: 16px;
            background: var(--card-bg);
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.05), 0 2px 4px -1px rgba(0, 0, 0, 0.03);
            transition: all 0.3s ease;
            overflow: hidden;
        }
        .card:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1);
        }

        /* Wallet Card */
        .wallet-card {
            background: linear-gradient(120deg, #2563eb, #1d4ed8);
            color: white;
            position: relative;
        }
        .wallet-card::after {
            content: '';
            position: absolute;
            right: -20px;
            top: -20px;
            width: 150px;
            height: 150px;
            background: rgba(255,255,255,0.1);
            border-radius: 50%;
            filter: blur(40px);
        }

        /* Tables */
        .table thead th {
            background-color: #f1f5f9;
            color: #64748b;
            font-weight: 600;
            text-transform: uppercase;
            font-size: 0.75rem;
            letter-spacing: 0.05em;
            border: none;
            padding: 1rem;
        }
        .table tbody td {
            padding: 1rem;
            border-bottom: 1px solid #f1f5f9;
            vertical-align: middle;
        }

        /* Auth Box */
        .auth-box {
            background: #eff6ff;
            color: #1d4ed8;
            padding: 4px 10px;
            border-radius: 6px;
            font-family: 'Outfit', sans-serif; /* Ø®Ø· Ø¥Ù†Ø¬Ù„ÙŠØ²ÙŠ Ù„Ù„Ø£Ø±Ù‚Ø§Ù… */
            font-size: 0.9rem;
            font-weight: 500;
            letter-spacing: 0.5px;
            border: 1px solid #dbeafe;
        }

        /* Modal Styling */
        .modal-content {
            border-radius: 20px;
            border: none;
            box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.25);
        }
        .modal-header {
            border-bottom: 1px solid #f1f5f9;
            padding: 1.5rem;
        }
        .modal-title {
            font-weight: 700;
        }
        .modal-body {
            padding: 2rem;
        }

        /* Flag Header in Modal */
        .country-header {
            text-align: center;
            padding: 2rem 0;
            margin-bottom: 1.5rem;
            border-radius: 12px;
            position: relative;
            overflow: hidden;
        }
        .country-header.eg { background: linear-gradient(135deg, #fef2f2, #fff1f2); border: 1px solid #fecaca; }
        .country-header.sa { background: linear-gradient(135deg, #f0fdf4, #dcfce7); border: 1px solid #bbf7d0; }
        
        .flag-icon {
            font-size: 3.5rem;
            display: block;
            margin-bottom: 0.5rem;
            filter: drop-shadow(0 4px 6px rgba(0,0,0,0.1));
        }
    </style>
</head>
<body>

    <!-- Navbar -->
    <nav class="navbar navbar-expand-lg navbar-dark sticky-top">
        <div class="container">
            <a class="navbar-brand d-flex align-items-center gap-2" href="#">
                <div class="bg-white text-primary rounded-circle d-flex align-items-center justify-content-center" style="width: 35px; height: 35px;">
                    <i class="bi bi-code-slash fw-bold"></i>
                </div>
                <span>Meta<span class="fw-light opacity-75">Dev</span></span>
            </a>
            
            <div class="d-flex align-items-center gap-3">
                <div class="d-none d-md-block text-white text-end lh-1 me-2">
                    <div class="small opacity-75">Ù…Ø±Ø­Ø¨Ø§Ù‹ØŒ</div>
                    <div class="fw-bold"><%= developer.name %></div>
                </div>
                <a href="/dev/support" class="btn btn-warning btn-sm fw-bold rounded-pill px-3">
                    <i class="bi bi-headset me-1"></i> Ø§Ù„Ø¯Ø¹Ù…
                </a>
                <a href="/logout" class="btn btn-outline-light btn-sm rounded-pill px-3">
                    <i class="bi bi-box-arrow-left"></i>
                </a>
            </div>
        </div>
    </nav>

    <div class="container py-5">
        
        <!-- Top Stats Row -->
        <div class="row g-4 mb-5 justify-content-center">
            <!-- Wallet Card -->
            <div class="col-lg-5">
                <div class="card wallet-card h-100 p-4">
                    <div class="d-flex justify-content-between align-items-start mb-4">
                        <div>
                            <h6 class="text-white-50 text-uppercase ls-1 mb-1">Ø±ØµÙŠØ¯ Ø§Ù„Ù…Ø­ÙØ¸Ø©</h6>
                            <h2 class="display-5 fw-bold mb-0">
                                <%= parseFloat(developer.wallet_balance).toFixed(2) %> <span class="fs-5 text-white-50">Ø¬.Ù…</span>
                            </h2>
                        </div>
                        <div class="bg-white bg-opacity-25 p-2 rounded-circle">
                            <i class="bi bi-wallet2 fs-4 text-white"></i>
                        </div>
                    </div>
                    <button class="btn btn-light w-100 fw-bold rounded-pill" onclick="alert('ÙŠØ±Ø¬Ù‰ Ø§Ù„ØªÙˆØ§ØµÙ„ Ù…Ø¹ Ø§Ù„Ø¥Ø¯Ø§Ø±Ø© Ù„Ù„Ø´Ø­Ù†')">
                        <i class="bi bi-plus-lg me-1"></i> Ø´Ø­Ù† Ø§Ù„Ù…Ø­ÙØ¸Ø©
                    </button>
                </div>
            </div>

            <!-- Quick Add -->
            <div class="col-lg-7">
                <div class="card h-100 p-4 border-primary border-start border-4">
                    <h5 class="fw-bold text-dark mb-4"><i class="bi bi-building-add me-2 text-primary"></i> ØªØ³Ø¬ÙŠÙ„ Ø¹Ù…ÙŠÙ„ Ø¬Ø¯ÙŠØ¯</h5>
                    <form action="/dev/add-company" method="POST" class="row g-3">
                        <div class="col-md-5">
                            <label class="small text-muted mb-1">Ø§Ø³Ù… Ø§Ù„Ù†Ø´Ø§Ø· Ø§Ù„ØªØ¬Ø§Ø±ÙŠ</label>
                            <input type="text" name="name" class="form-control bg-light border-0" placeholder="Ù…Ø«Ø§Ù„: Ø³ÙˆØ¨Ø± Ù…Ø§Ø±ÙƒØª Ø§Ù„Ù†ÙˆØ±" required>
                        </div>
                        <div class="col-md-4">
                            <label class="small text-muted mb-1">Ø§Ù„Ø±Ù‚Ù… Ø§Ù„Ø¶Ø±ÙŠØ¨ÙŠ</label>
                            <input type="text" name="tax_id" class="form-control bg-light border-0" placeholder="123456..." required>
                        </div>
                        <div class="col-md-3">
                            <label class="small text-muted mb-1">Ø§Ù„Ø¯ÙˆÙ„Ø©</label>
                            <select name="country_code" class="form-select bg-light border-0">
                                <option value="EG">Ù…ØµØ± ğŸ‡ªğŸ‡¬</option>
                                <option value="SA">Ø§Ù„Ø³Ø¹ÙˆØ¯ÙŠØ© ğŸ‡¸ğŸ‡¦</option>
                            </select>
                        </div>
                        <div class="col-12 text-end mt-3">
                            <button type="submit" class="btn btn-primary px-4 rounded-pill fw-bold">
                                Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ø­Ø³Ø§Ø¨ <i class="bi bi-arrow-left ms-1"></i>
                            </button>
                        </div>
                    </form>
                </div>
            </div>
        </div>

        <!-- Companies List -->
        <div class="card shadow-sm">
            <div class="card-header bg-white py-3 px-4 d-flex justify-content-between align-items-center">
                <h5 class="mb-0 fw-bold text-dark"><i class="bi bi-grid-fill me-2 text-secondary"></i> Ø¹Ù…Ù„Ø§Ø¦ÙŠ Ø§Ù„Ù…Ø³Ø¬Ù„ÙŠÙ†</h5>
                <span class="badge bg-primary bg-opacity-10 text-primary rounded-pill px-3"><%= companies.length %> Ø´Ø±ÙƒØ©</span>
            </div>
            <div class="table-responsive">
                <table class="table align-middle mb-0">
                    <thead>
                        <tr>
                            <th class="ps-4">Ø§Ù„Ø´Ø±ÙƒØ©</th>
                            <th>Ø§Ù„Ø±ØµÙŠØ¯ Ø§Ù„Ù…Ø®ØµØµ</th>
                            <th>Ø§Ø³ØªÙ‡Ù„Ø§Ùƒ Ø§Ù„ÙÙˆØ§ØªÙŠØ±</th>
                            <th width="25%">Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø¯Ø®ÙˆÙ„</th>
                            <th class="text-center pe-4">ØªØ­ÙƒÙ…</th>
                        </tr>
                    </thead>
                    <tbody>
                        <% companies.forEach(function(comp) { %>
                            <tr>
                                <td class="ps-4">
                                    <div class="d-flex align-items-center gap-3">
                                        <div class="avatar bg-light rounded-circle d-flex align-items-center justify-content-center text-primary fw-bold" style="width: 40px; height: 40px;">
                                            <%= comp.name.charAt(0) %>
                                        </div>
                                        <div>
                                            <div class="fw-bold text-dark"><%= comp.name %></div>
                                            <div class="small text-muted d-flex align-items-center gap-2">
                                                <i class="bi bi-geo-alt-fill"></i> <%= comp.country_code === 'EG' ? 'Ù…ØµØ±' : 'Ø§Ù„Ø³Ø¹ÙˆØ¯ÙŠØ©' %>
                                                <span class="text-secondary">|</span>
                                                <span class="font-monospace"><%= comp.tax_id %></span>
                                            </div>
                                        </div>
                                    </div>
                                </td>
                                <td>
                                    <% if(comp.allocated_balance > 0) { %>
                                        <div class="fw-bold text-success"><%= parseFloat(comp.allocated_balance).toFixed(2) %> Ø¬.Ù…</div>
                                        <small class="text-muted" style="font-size: 0.75rem;">Ø±ØµÙŠØ¯ Ù…ØªØ§Ø­</small>
                                    <% } else { %>
                                        <span class="badge bg-light text-muted border">0.00</span>
                                    <% } %>
                                </td>
                                <td>
                                    <div class="d-flex align-items-center gap-2">
                                        <div class="progress flex-grow-1" style="height: 6px; width: 80px;">
                                            <% let percent = (comp.invoices_used / (comp.invoice_limit || 1)) * 100; %>
                                            <div class="progress-bar bg-primary" style="width: <%= percent %>%"></div>
                                        </div>
                                        <span class="small fw-bold"><%= comp.invoices_used %>/<%= comp.invoice_limit %></span>
                                    </div>
                                </td>
                                <td>
                                    <div class="bg-light p-2 rounded border d-flex justify-content-between align-items-center" style="max-width: 220px;">
                                        <div class="d-flex flex-column gap-1">
                                            <!-- Ù…Ø¹Ø±Ù Ø§Ù„Ø¹Ù†ØµØ± Ù‡Ù†Ø§ Ù…Ù‡Ù… Ù„ØªØ­Ø¯ÙŠØ«Ù‡ Ø¨Ø§Ù„Ù€ JavaScript -->
                                            <span class="auth-box border-0 bg-white px-2 py-0" id="username-display-<%= comp.id %>">
                                                store_<%= comp.id %>
                                            </span>
                                            <span class="small text-muted px-2">******</span>
                                        </div>
                                        <button class="btn btn-sm btn-white text-primary shadow-sm" 
                                                onclick="openAuthModal('<%= comp.id %>', '<%= comp.name %>', 'store_<%= comp.id %>')"
                                                data-bs-toggle="tooltip" title="ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„">
                                            <i class="bi bi-pencil-square"></i>
                                        </button>
                                    </div>
                                </td>
                                <td class="text-center pe-4">
                                    <div class="d-flex justify-content-end gap-2">
                                        <button class="btn btn-success btn-sm fw-bold px-3 rounded-pill shadow-sm" 
                                                onclick="openAllocateModal('<%= comp.id %>', '<%= comp.name %>')">
                                            <i class="bi bi-cash-stack me-1"></i> ØªØ­ÙˆÙŠÙ„
                                        </button>
                                        <button class="btn btn-light btn-sm border rounded-circle shadow-sm" style="width: 32px; height: 32px;"
                                                onclick="openCredsModal('<%= comp.id %>', '<%= comp.name %>', '<%= comp.country_code %>')"
                                                title="Ø§Ù„Ø±Ø¨Ø·">
                                            <i class="bi bi-gear-fill text-secondary"></i>
                                        </button>
                                        <a href="/docs?company_id=<%= comp.id %>" class="btn btn-primary btn-sm rounded-circle shadow-sm" style="width: 32px; height: 32px;">
                                            <i class="bi bi-code-slash"></i>
                                        </a>
                                    </div>
                                </td>
                            </tr>
                        <% }); %>
                    </tbody>
                </table>
            </div>
        </div>
    </div>

    <!-- =================== MODALS (Ø§Ù„Ù…Ø·ÙˆØ±Ø©) =================== -->

    <!-- 1. Modal ØªØ¹Ø¯ÙŠÙ„ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø¯Ø®ÙˆÙ„ -->
    <div class="modal fade" id="authUpdateModal" tabindex="-1">
        <div class="modal-dialog modal-dialog-centered">
            <div class="modal-content">
                <div class="modal-header bg-light">
                    <h5 class="modal-title text-dark"><i class="bi bi-shield-lock me-2 text-primary"></i> ØªØ£Ù…ÙŠÙ† Ø§Ù„Ø­Ø³Ø§Ø¨</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <form action="/dev/update-store-auth" method="POST">
                        <input type="hidden" name="company_id" id="auth_company_id">
                        
                        <div class="text-center mb-4">
                            <div class="bg-primary bg-opacity-10 p-3 rounded-circle d-inline-flex mb-2">
                                <i class="bi bi-person-gear fs-1 text-primary"></i>
                            </div>
                            <h6 class="fw-bold" id="auth_company_name"></h6>
                            <small class="text-muted">ØªØ­Ø¯ÙŠØ« Ø¨ÙŠØ§Ù†Ø§Øª Ø¯Ø®ÙˆÙ„ Ø§Ù„Ø¹Ù…ÙŠÙ„ Ù„Ù„Ø¨ÙˆØ§Ø¨Ø©</small>
                        </div>

                        <div class="form-floating mb-3">
                            <input type="text" name="new_username" id="auth_new_username" class="form-control" placeholder="Username" required minlength="4">
                            <label>Ø§Ø³Ù… Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… Ø§Ù„Ø¬Ø¯ÙŠØ¯</label>
                        </div>

                        <div class="form-floating mb-4">
                            <input type="text" name="new_password" class="form-control" placeholder="Password" required minlength="6">
                            <label>ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ± Ø§Ù„Ø¬Ø¯ÙŠØ¯Ø©</label>
                        </div>

                        <div class="d-grid">
                            <button type="submit" class="btn btn-primary py-2 fw-bold">Ø­ÙØ¸ Ø§Ù„ØªØ­Ø¯ÙŠØ«Ø§Øª</button>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>

    <!-- 2. Modal ØªØ­ÙˆÙŠÙ„ Ø§Ù„Ø±ØµÙŠØ¯ (Ø§Ù„Ù…Ø·ÙˆØ±) -->
    <div class="modal fade" id="allocateModal" tabindex="-1">
        <div class="modal-dialog modal-dialog-centered">
            <div class="modal-content">
                <div class="modal-body p-0">
                    <div class="bg-success p-4 text-white text-center" style="border-radius: 20px 20px 0 0;">
                        <h6 class="text-white-50 text-uppercase mb-1">Ø±ØµÙŠØ¯ Ù…Ø­ÙØ¸ØªÙƒ Ø§Ù„Ù…ØªØ§Ø­</h6>
                        <h1 class="fw-bold mb-0"><%= parseFloat(developer.wallet_balance).toFixed(2) %></h1>
                        <small>Ø¬Ù†ÙŠÙ‡ Ù…ØµØ±ÙŠ</small>
                    </div>
                    <div class="p-4">
                        <form action="/dev/allocate-balance" method="POST">
                            <input type="hidden" name="company_id" id="alloc_company_id">
                            
                            <div class="text-center mb-4">
                                <p class="text-muted mb-1">ØªØ­ÙˆÙŠÙ„ Ø±ØµÙŠØ¯ Ø¥Ù„Ù‰:</p>
                                <h5 class="fw-bold text-dark" id="alloc_company_name"></h5>
                            </div>

                            <div class="input-group input-group-lg mb-4 border rounded overflow-hidden">
                                <span class="input-group-text bg-light border-0 text-muted">EGP</span>
                                <input type="number" name="amount" class="form-control border-0 text-center fw-bold fs-4" placeholder="0.00" min="1" step="0.01" required>
                            </div>

                            <div class="d-grid">
                                <button type="submit" class="btn btn-success py-3 fw-bold rounded-pill shadow-sm">
                                    ØªØ£ÙƒÙŠØ¯ Ø§Ù„ØªØ­ÙˆÙŠÙ„ <i class="bi bi-check-circle-fill ms-2"></i>
                                </button>
                            </div>
                        </form>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- 3. Modal Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ø±Ø¨Ø· (Ø¨Ø§Ù„Ø¹Ù„Ù…) -->
    <div class="modal fade" id="credsModal" tabindex="-1">
        <div class="modal-dialog modal-dialog-centered">
            <div class="modal-content overflow-hidden">
                <div class="modal-body p-0">
                    <form action="/dev/company/update-creds" method="POST">
                        <input type="hidden" name="company_id" id="creds_company_id">
                        <input type="hidden" name="country_code" id="creds_country_code">

                        <!-- Header with Flag (Dynamic) -->
                        <div id="modal_header_bg" class="country-header">
                            <span id="modal_flag" class="flag-icon"></span>
                            <h5 class="fw-bold mb-0" id="modal_country_name"></h5>
                            <small class="text-muted" id="creds_company_name_display"></small>
                        </div>

                        <div class="px-4 pb-4">
                            <!-- Egypt Fields -->
                            <div id="egypt_fields" style="display:none;">
                                <div class="alert alert-light border text-center mb-3 small">
                                    <i class="bi bi-info-circle text-primary"></i> Ø£Ø¯Ø®Ù„ Ø¨ÙŠØ§Ù†Ø§Øª Ù…Ù†Ø¸ÙˆÙ…Ø© Ø§Ù„ÙØ§ØªÙˆØ±Ø© (ETA)
                                </div>
                                <div class="mb-3">
                                    <label class="form-label fw-bold small text-muted">Client ID</label>
                                    <input type="text" name="client_id" class="form-control bg-light" placeholder="xxxxxxxx-xxxx-xxxx...">
                                </div>
                                <div class="mb-3">
                                    <label class="form-label fw-bold small text-muted">Client Secret</label>
                                    <input type="password" name="client_secret" class="form-control bg-light" placeholder="â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢">
                                </div>
                            </div>

                            <!-- Saudi Fields -->
                            <div id="saudi_fields" style="display:none;">
                                <div class="alert alert-light border text-center mb-3 small">
                                    <i class="bi bi-info-circle text-success"></i> Ø£Ø¯Ø®Ù„ Ø±Ù…Ø² OTP Ù…Ù† Ù…Ù†ØµØ© "ÙØ§ØªÙˆØ±Ø©" (ZATCA)
                                </div>
                                <div class="mb-3">
                                    <label class="form-label fw-bold small text-muted">OTP Code</label>
                                    <div class="input-group">
                                        <span class="input-group-text bg-white border-end-0"><i class="bi bi-shield-lock text-success"></i></span>
                                        <input type="text" name="otp" class="form-control border-start-0" placeholder="123456" maxlength="6">
                                    </div>
                                </div>
                            </div>

                            <div class="d-grid mt-4">
                                <button type="submit" class="btn btn-dark py-2 fw-bold">
                                    <i class="bi bi-save me-2"></i> Ø­ÙØ¸ Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª
                                </button>
                            </div>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        // 1. Auth Modal
        function openAuthModal(id, name, currentUsername) {
            document.getElementById('auth_company_id').value = id;
            document.getElementById('auth_company_name').innerText = name;
            
            // Ø¬Ù„Ø¨ Ø§Ù„Ø§Ø³Ù… Ø§Ù„Ø­Ø§Ù„ÙŠ Ù…Ù† Ø§Ù„ØµÙØ­Ø© Ù„ØªØ¹Ø¨Ø¦ØªÙ‡ ÙÙŠ Ø§Ù„Ø­Ù‚Ù„
            const displayEl = document.getElementById('username-display-' + id);
            const currentVal = displayEl ? displayEl.innerText.trim() : '';
            document.getElementById('auth_new_username').value = currentVal;
            
            new bootstrap.Modal(document.getElementById('authUpdateModal')).show();
        }

        // 2. Allocate Modal
        function openAllocateModal(id, name) {
            document.getElementById('alloc_company_id').value = id;
            document.getElementById('alloc_company_name').innerText = name;
            new bootstrap.Modal(document.getElementById('allocateModal')).show();
        }

        // 3. Credentials Modal (Flag Logic)
        function openCredsModal(id, name, countryCode) {
            document.getElementById('creds_company_id').value = id;
            document.getElementById('creds_company_name_display').innerText = name;
            document.getElementById('creds_country_code').value = countryCode;
            
            const header = document.getElementById('modal_header_bg');
            const flag = document.getElementById('modal_flag');
            const countryName = document.getElementById('modal_country_name');
            
            // Reset classes
            header.classList.remove('eg', 'sa');

            if(countryCode === 'EG') {
                header.classList.add('eg');
                flag.innerText = 'ğŸ‡ªğŸ‡¬';
                countryName.innerText = 'Ù…ØµØ± (E-Invoice)';
                countryName.className = "fw-bold mb-0 text-dark";
                
                document.getElementById('egypt_fields').style.display = 'block';
                document.getElementById('saudi_fields').style.display = 'none';
            } else {
                header.classList.add('sa');
                flag.innerText = 'ğŸ‡¸ğŸ‡¦';
                countryName.innerText = 'Ø§Ù„Ù…Ù…Ù„ÙƒØ© Ø§Ù„Ø¹Ø±Ø¨ÙŠØ© Ø§Ù„Ø³Ø¹ÙˆØ¯ÙŠØ©';
                countryName.className = "fw-bold mb-0 text-success";
                
                document.getElementById('egypt_fields').style.display = 'none';
                document.getElementById('saudi_fields').style.display = 'block';
            }
            
            new bootstrap.Modal(document.getElementById('credsModal')).show();
        }

        // 4. Ø±Ø³Ø§Ø¦Ù„ Ø§Ù„Ù†Ø¬Ø§Ø­ ÙˆØªØ­Ø¯ÙŠØ« Ø§Ù„ÙˆØ§Ø¬Ù‡Ø© (DOM Update Logic)
        const urlParams = new URLSearchParams(window.location.search);
        if(urlParams.get('msg') === 'auth_updated') {
            // Ø§Ù„Ø­Ù„ Ù„Ù…Ø´ÙƒÙ„Ø© "Ø§Ù„ØªØ­Ø¯ÙŠØ« Ø§Ù„ÙˆÙ‡Ù…ÙŠ": 
            // Ù†Ø¸Ø±Ø§Ù‹ Ù„Ø£Ù† Ø§Ù„ØµÙØ­Ø© Ù‚Ø¯ ØªÙƒÙˆÙ† cacheØŒ Ù†Ø­Ù† Ù†Ø¹ØªÙ…Ø¯ Ø¹Ù„Ù‰ Ø£Ù† Ø§Ù„Ù…Ø·ÙˆØ± Ø£Ø¯Ø®Ù„ Ø¨ÙŠØ§Ù†Ø§Øª ØµØ­ÙŠØ­Ø©
            // ÙÙŠ Ø§Ù„ÙˆØ§Ù‚Ø¹ Ø§Ù„Ø£ÙØ¶Ù„ Ù‡Ùˆ Ø§Ù„Ø§Ø¹ØªÙ…Ø§Ø¯ Ø¹Ù„Ù‰ Ø§Ù„Ù€ Server Rendering Ù„Ù„Ù‚ÙŠÙ…Ø© Ø§Ù„Ø¬Ø¯ÙŠØ¯Ø©
            // Ù„ÙƒÙ† ÙƒØ­Ù„ Ø³Ø±ÙŠØ¹ØŒ Ø³Ù†Ø¹Ø±Ø¶ Ø±Ø³Ø§Ù„Ø© ØªØ£ÙƒÙŠØ¯ ÙˆØ§Ø¶Ø­Ø©
            
            const successModal = document.createElement('div');
            successModal.innerHTML = `
                <div class="position-fixed top-0 start-50 translate-middle-x mt-4 p-3 rounded-pill bg-success text-white shadow-lg animate__animated animate__fadeInDown" style="z-index: 9999;">
                    <i class="bi bi-check-circle-fill me-2"></i> ØªÙ… ØªØ­Ø¯ÙŠØ« Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø¯Ø®ÙˆÙ„ Ø¨Ù†Ø¬Ø§Ø­!
                </div>
            `;
            document.body.appendChild(successModal);
            setTimeout(() => successModal.remove(), 3000);
            
            // ØªÙ†Ø¸ÙŠÙ Ø§Ù„Ø±Ø§Ø¨Ø·
            window.history.replaceState({}, document.title, window.location.pathname);
        }
    </script>
</body>
</html>
