<!DOCTYPE html>
<html lang="ar" dir="rtl">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MetaConnect - Ø¯Ù„ÙŠÙ„ Ø§Ù„Ø±Ø¨Ø· Ø§Ù„Ø´Ø§Ù…Ù„</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.rtl.min.css">
    <style>
        :root {
            --primary-color: #0d6efd;
            --bg-color: #f4f7f6;
            --card-bg: #ffffff;
            --code-bg: #1e1e1e;
        }

        body {
            background: var(--bg-color);
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            padding-top: 40px;
            padding-bottom: 40px;
            color: #333;
        }

        .main-container {
            max-width: 1000px;
            margin: 0 auto;
        }

        .header-section {
            text-align: center;
            margin-bottom: 40px;
        }

        .header-section h1 {
            font-weight: 800;
            color: var(--primary-color);
            margin-bottom: 10px;
        }

        .card-custom {
            background: var(--card-bg);
            border: none;
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.08);
            overflow: hidden;
            margin-bottom: 30px;
        }

        .card-header-custom {
            background: #f8f9fa;
            padding: 20px 30px;
            border-bottom: 1px solid #eee;
            font-weight: bold;
            font-size: 1.1rem;
        }

        .card-body-custom {
            padding: 30px;
        }

        .step-badge {
            background: var(--primary-color);
            color: white;
            width: 30px;
            height: 30px;
            border-radius: 50%;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            margin-left: 10px;
            font-weight: bold;
        }

        .step-item {
            margin-bottom: 20px;
            display: flex;
            align-items: flex-start;
        }

        .code-preview {
            background: var(--code-bg);
            color: #d4d4d4;
            padding: 20px;
            border-radius: 8px;
            font-family: 'Consolas', 'Monaco', monospace;
            font-size: 14px;
            direction: ltr;
            text-align: left;
            overflow-x: auto;
            position: relative;
            margin-top: 15px;
            border: 1px solid #333;
        }

        .copy-btn {
            position: absolute;
            top: 10px;
            right: 10px;
            background: rgba(255, 255, 255, 0.1);
            color: white;
            border: 1px solid rgba(255, 255, 255, 0.2);
            padding: 5px 10px;
            border-radius: 4px;
            font-size: 12px;
            cursor: pointer;
            transition: all 0.3s;
        }

        .copy-btn:hover {
            background: rgba(255, 255, 255, 0.2);
        }

        .param-table th {
            background-color: #f8f9fa;
        }

        .note-box {
            background-color: #e7f1ff;
            border-right: 4px solid #0d6efd;
            padding: 15px;
            border-radius: 4px;
            margin-top: 20px;
        }
    </style>
</head>

<body>

    <div class="container main-container">
        
        <!-- Ø±Ø£Ø³ Ø§Ù„ØµÙØ­Ø© -->
        <div class="header-section">
            <h1>âš¡ MetaConnect API</h1>
            <p class="lead text-muted">Ø¯Ù„ÙŠÙ„ Ø§Ù„Ù…Ø·ÙˆØ± Ù„Ù„Ø±Ø¨Ø· Ù…Ø¹ Ù…Ù†Ø¸ÙˆÙ…Ø© Ø§Ù„ÙØ§ØªÙˆØ±Ø© Ø§Ù„Ø¶Ø±ÙŠØ¨ÙŠØ©</p>
            
            <% if(typeof userType !== 'undefined' && userType === 'developer' && typeof exampleConfig !== 'undefined') { %>
            <div class="d-inline-block bg-white px-4 py-2 rounded-pill shadow-sm mt-2 border">
                <span class="text-muted">Ø§Ù„Ù…Ø¹Ø±Ù Ø§Ù„Ø¶Ø±ÙŠØ¨ÙŠ Ø§Ù„Ø®Ø§Øµ Ø¨Ùƒ (Tax ID):</span>
                <strong class="text-primary ms-2" id="displayTaxId"><%= exampleConfig.tax_id %></strong>
            </div>
            <% } else { %>
            <!-- Fallback for static view -->
            <div class="d-inline-block bg-white px-4 py-2 rounded-pill shadow-sm mt-2 border">
                <span class="text-muted">Ø§Ù„Ù…Ø¹Ø±Ù Ø§Ù„Ø¶Ø±ÙŠØ¨ÙŠ Ø§Ù„Ø®Ø§Øµ Ø¨Ùƒ (Tax ID):</span>
                <strong class="text-primary ms-2" id="displayTaxId">312345678900003</strong>
            </div>
            <% } %>
        </div>

        <!-- Ø§Ø®ØªÙŠØ§Ø± Ø§Ù„Ù„ØºØ© -->
        <div class="card-custom">
            <div class="card-body-custom text-center">
                <h5 class="mb-4">Ø¨Ø£ÙŠ Ù„ØºØ© Ø¨Ø±Ù…Ø¬Ø© ÙŠØ¹Ù…Ù„ Ù†Ø¸Ø§Ù…ÙƒØŸ</h5>
                <div class="row justify-content-center">
                    <div class="col-md-6">
                        <select id="langSelect" class="form-select form-select-lg shadow-none border-primary" onchange="updateContent()">
                            <option value="" selected disabled>-- Ø§Ø®ØªØ± Ø¨ÙŠØ¦Ø© Ø§Ù„Ø¹Ù…Ù„ --</option>
                            <option value="js">JavaScript (Frontend / Node.js)</option>
                            <option value="php">PHP (Laravel / Native)</option>
                            <option value="csharp">C# (.NET / Desktop)</option>
                            <option value="python">Python (Django / Flask)</option>
                        </select>
                    </div>
                </div>
            </div>
        </div>

        <!-- Ø§Ù„Ù…Ø­ØªÙˆÙ‰ Ø§Ù„Ø¯ÙŠÙ†Ø§Ù…ÙŠÙƒÙŠ -->
        <div id="contentArea" style="display: none;">
            
            <!-- Ù‚Ø³Ù… Ø§Ù„ØªØ¹Ù„ÙŠÙ…Ø§Øª -->
            <div class="card-custom">
                <div class="card-header-custom">
                    ğŸ“š Ø®Ø·ÙˆØ§Øª Ø§Ù„Ø±Ø¨Ø· (Integration Steps)
                </div>
                <div class="card-body-custom">
                    
                    <!-- Ø§Ù„Ø®Ø·ÙˆØ© 1 -->
                    <div class="step-item">
                        <div class="step-badge">1</div>
                        <div class="w-100">
                            <h5 class="fw-bold">ØªØ¶Ù…ÙŠÙ† Ø§Ù„ÙƒÙˆØ¯ (Installation)</h5>
                            <p class="text-muted" id="step1-desc">Ø§Ù†Ø³Ø® Ø§Ù„ÙƒÙˆØ¯ Ø£Ø¯Ù†Ø§Ù‡ ÙˆØ¶Ø¹Ù‡ ÙÙŠ Ø§Ù„Ù…ÙƒØ§Ù† Ø§Ù„Ù…Ø®ØµØµ.</p>
                            
                            <div class="code-preview">
                                <button class="copy-btn" onclick="copyToClipboard('mainCode')">Ù†Ø³Ø®</button>
                                <pre id="mainCode"></pre>
                            </div>
                        </div>
                    </div>

                    <hr class="my-4">

                    <!-- Ø§Ù„Ø®Ø·ÙˆØ© 2 -->
                    <div class="step-item">
                        <div class="step-badge">2</div>
                        <div class="w-100">
                            <h5 class="fw-bold">Ø§Ø³ØªØ¯Ø¹Ø§Ø¡ Ø§Ù„Ø¯Ø§Ù„Ø© (Usage)</h5>
                            <p class="text-muted">Ø¹Ù†Ø¯ Ù‚ÙŠØ§Ù… Ø§Ù„Ø¹Ù…ÙŠÙ„ Ø¨Ø¥ØªÙ…Ø§Ù… Ø§Ù„Ø·Ù„Ø¨ (Checkout)ØŒ Ù‚Ù… Ø¨Ø§Ø³ØªØ¯Ø¹Ø§Ø¡ Ø§Ù„Ø¯Ø§Ù„Ø© ÙƒØ§Ù„ØªØ§Ù„ÙŠ:</p>
                            
                            <div class="code-preview">
                                <button class="copy-btn" onclick="copyToClipboard('usageCode')">Ù†Ø³Ø®</button>
                                <pre id="usageCode"></pre>
                            </div>
                        </div>
                    </div>

                </div>
            </div>

            <!-- ØªÙØ§ØµÙŠÙ„ Ø§Ù„Ù…ØªØºÙŠØ±Ø§Øª -->
            <div class="card-custom">
                <div class="card-header-custom">
                    âš™ï¸ ØªÙØ§ØµÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª (Parameters)
                </div>
                <div class="card-body-custom">
                    <table class="table table-hover param-table">
                        <thead>
                            <tr>
                                <th>Ø§Ù„Ù…ØªØºÙŠØ±</th>
                                <th>Ø§Ù„Ù†ÙˆØ¹</th>
                                <th>Ø¥Ø¬Ø¨Ø§Ø±ÙŠØŸ</th>
                                <th>Ø§Ù„ÙˆØµÙ</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td>de>totalAmount</code></td>
                                <td>Ø±Ù‚Ù… (Decimal)</td>
                                <td><span class="badge bg-danger">Ù†Ø¹Ù…</span></td>
                                <td>Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ù‚ÙŠÙ…Ø© Ø§Ù„ÙØ§ØªÙˆØ±Ø© Ø´Ø§Ù…Ù„Ø© Ø§Ù„Ø¶Ø±ÙŠØ¨Ø©.</td>
                            </tr>
                            <tr>
                                <td>de>itemsList</code></td>
                                <td>Ù…ØµÙÙˆÙØ© (Array)</td>
                                <td><span class="badge bg-danger">Ù†Ø¹Ù…</span></td>
                                <td>Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ù…Ù†ØªØ¬Ø§ØªØŒ ÙƒÙ„ Ù…Ù†ØªØ¬ ÙŠØ¬Ø¨ Ø£Ù† ÙŠØ­ØªÙˆÙŠ Ø¹Ù„Ù‰ (name, price).</td>
                            </tr>
                            <tr>
                                <td>de>isLive</code></td>
                                <td>Boolean</td>
                                <td><span class="badge bg-secondary">Ø§Ø®ØªÙŠØ§Ø±ÙŠ</span></td>
                                <td>
                                    de>false</code> Ù„Ù„ØªØ¬Ø±Ø¨Ø© (Sandbox)<br>
                                    de>true</code> Ù„Ù„Ø¥Ø·Ù„Ø§Ù‚ Ø§Ù„ÙØ¹Ù„ÙŠ (Live)
                                </td>
                            </tr>
                        </tbody>
                    </table>

                    <div class="note-box">
                        <strong>ğŸ’¡ Ù…Ù„Ø§Ø­Ø¸Ø© Ù‡Ø§Ù…Ø©:</strong>
                        ØªØ£ÙƒØ¯ Ù…Ù† ØªØºÙŠÙŠØ± Ø­Ø§Ù„Ø© de>isLive</code> Ø¥Ù„Ù‰ de>true</code> ÙÙ‚Ø· Ø¹Ù†Ø¯Ù…Ø§ ØªÙ†ØªÙ‡ÙŠ Ù…Ù† Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø±Ø§Øª ÙˆØªÙƒÙˆÙ† Ø¬Ø§Ù‡Ø²Ø§Ù‹ Ù„Ø¥ØµØ¯Ø§Ø± ÙÙˆØ§ØªÙŠØ± Ø­Ù‚ÙŠÙ‚ÙŠØ© Ù„Ù„Ø¶Ø±Ø§Ø¦Ø¨.
                    </div>
                </div>
            </div>

        </div>

    </div>

    <!-- Ø§Ù„Ù‚ÙŠÙ… Ø§Ù„Ù…Ø®ÙÙŠØ© Ù„Ù„ØªÙ‡ÙŠØ¦Ø© -->
    <input type="hidden" id="taxIdValue" value="<%= (typeof exampleConfig !== 'undefined' && exampleConfig.tax_id) ? exampleConfig.tax_id : '312345678900003' %>">

    <script>
        // Ø§Ø³ØªØ®Ø¯Ø§Ù… currentTaxId Ù„ØªÙ…ÙŠÙŠØ²Ù‡ Ø¹Ù† Ø§Ù„Ù…ØªØºÙŠØ± Ø¯Ø§Ø®Ù„ Ø§Ù„Ù†ØµÙˆØµ Ø§Ù„Ù…ÙˆÙ„Ø¯Ø©
        const currentTaxId = document.getElementById('taxIdValue').value;
        const baseUrl = "https://metaconnect-server-three.vercel.app/api/v1";

        // Ø§Ù„Ù†ØµÙˆØµ ÙˆØ§Ù„ØªØ¹Ù„ÙŠÙ…Ø§Øª Ù„ÙƒÙ„ Ù„ØºØ©
        const contentData = {
            js: {
                step1Desc: "Ø¶Ø¹ Ù‡Ø°Ø§ Ø§Ù„ÙƒÙˆØ¯ ÙÙŠ Ù…Ù„Ù JavaScript Ø§Ù„Ø®Ø§Øµ Ø¨ØµÙØ­Ø© Ø§Ù„Ø¯ÙØ¹ (Checkout) Ø£Ùˆ Ø¯Ø§Ø®Ù„ ÙˆØ³Ù… &lt;script&gt; ÙÙŠ Ù†Ù‡Ø§ÙŠØ© Ø§Ù„ØµÙØ­Ø©.",
                mainCode: `/**
 * Ø¯Ø§Ù„Ø© Ø§Ù„Ø±Ø¨Ø· Ù…Ø¹ MetaConnect
 * ÙŠØ±Ø¬Ù‰ Ø¹Ø¯Ù… ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„Ø±Ø§Ø¨Ø· Ø£Ùˆ Ø§Ù„Ù…Ø¹Ø±Ù
 */
// Ù…Ø¹Ø±ÙÙƒ Ø§Ù„Ø¶Ø±ÙŠØ¨ÙŠ
const taxId = "${currentTaxId}";

async function sendInvoiceToTax(totalAmount, itemsList, isLive = false) {
    const env = isLive ? 'connect' : 'sandbox';
    const url = \`${baseUrl}/\${env}/\${taxId}\`;

    const payload = {
        total: totalAmount,
        date: new Date().toISOString().split('T')[0],
        items: itemsList.map(item => ({ 
            name: item.name, 
            price: item.price, 
            qty: item.quantity || 1 
        }))
    };

    console.log("ğŸ“¡ Connecting to:", url);

    try {
        const res = await fetch(url, {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify(payload)
        });
        
        const data = await res.json();
        
        if (res.ok) {
            console.log("âœ… Success:", data);
            alert("ØªÙ… Ø§Ù„ØªÙˆØ«ÙŠÙ‚ Ø§Ù„Ø¶Ø±ÙŠØ¨ÙŠ Ø¨Ù†Ø¬Ø§Ø­!");
            return true;
        } else {
            console.error("âŒ Error:", data);
            alert("ÙØ´Ù„ Ø§Ù„ØªÙˆØ«ÙŠÙ‚: " + data.message);
            return false;
        }
    } catch (err) {
        console.error("âš ï¸ Connection Error:", err);
        return false;
    }
}`,
                usageCode: `// Ù…Ø«Ø§Ù„: Ø¹Ù†Ø¯ Ø§Ù„Ø¶ØºØ· Ø¹Ù„Ù‰ Ø²Ø± "Ø¥ØªÙ…Ø§Ù… Ø§Ù„Ø·Ù„Ø¨"
const cartItems = [
    { name: "iPhone 15", price: 4000, quantity: 1 },
    { name: "Cover", price: 50, quantity: 2 }
];

// false = Ø¨ÙŠØ¦Ø© ØªØ¬Ø±ÙŠØ¨ÙŠØ©
sendInvoiceToTax(4100, cartItems, false);`
            },
            
            php: {
                step1Desc: "Ø§Ù†Ø³Ø® Ù‡Ø°Ù‡ Ø§Ù„Ø¯Ø§Ù„Ø© ÙˆØ¶Ø¹Ù‡Ø§ ÙÙŠ Ù…Ù„Ù `Helpers.php` Ø£Ùˆ Ø¯Ø§Ø®Ù„ Ø§Ù„Ù€ Controller Ø§Ù„Ø®Ø§Øµ Ø¨Ø§Ù„ÙÙˆØ§ØªÙŠØ±.",
                mainCode: `<?php
function sendInvoiceToTax($total, $items, $isLive = false) {
    $taxId = "${currentTaxId}";
    $env = $isLive ? 'connect' : 'sandbox';
    $url = "${baseUrl}/$env/$taxId";

    $data = [
        "total" => $total,
        "date" => date("Y-m-d"),
        "items" => $items // Array of ['name', 'price', 'qty']
    ];

    $ch = curl_init($url);
    curl_setopt($ch, CURLOPT_RETURNTRANSFER, true);
    curl_setopt($ch, CURLOPT_POST, true);
    curl_setopt($ch, CURLOPT_POSTFIELDS, json_encode($data));
    curl_setopt($ch, CURLOPT_HTTPHEADER, ['Content-Type: application/json']);
    
    $response = curl_exec($ch);
    $httpCode = curl_getinfo($ch, CURLINFO_HTTP_CODE);
    curl_close($ch);

    return [
        "success" => $httpCode == 200,
        "response" => json_decode($response, true)
    ];
}
?>`,
                usageCode: `// Ø¯Ø§Ø®Ù„ Ø¯Ø§Ù„Ø© Ø­ÙØ¸ Ø§Ù„Ø·Ù„Ø¨ (Store Order)
$items = [
    ["name" => "Laptop", "price" => 1500, "qty" => 1],
    ["name" => "Mouse", "price" => 50, "qty" => 1]
];

$result = sendInvoiceToTax(1550, $items, false);

if ($result['success']) {
    echo "ØªÙ… Ø§Ù„ØªÙˆØ«ÙŠÙ‚ Ø¨Ù†Ø¬Ø§Ø­!";
} else {
    echo "ÙØ´Ù„ Ø§Ù„ØªÙˆØ«ÙŠÙ‚: " . $result['response']['message'];
}`
            },

            csharp: {
                step1Desc: "Ø£Ø¶Ù Ù‡Ø°Ø§ Ø§Ù„ÙƒÙ„Ø§Ø³ ÙÙŠ Ù…Ø´Ø±ÙˆØ¹Ùƒ (Service Layer) Ø£Ùˆ Ø¯Ø§Ø®Ù„ Ø§Ù„Ù€ Form.",
                mainCode: `using System.Net.Http;
using System.Text;
using Newtonsoft.Json; // ØªØ£ÙƒØ¯ Ù…Ù† ØªØ«Ø¨ÙŠØª Ù‡Ø°Ù‡ Ø§Ù„Ù…ÙƒØªØ¨Ø©

public class TaxService
{
    private static readonly HttpClient client = new HttpClient();
    private string taxId = "${currentTaxId}";
    private string baseUrl = "${baseUrl}";

    public async Task<bool> SendInvoice(decimal total, object items, bool isLive = false)
    {
        string env = isLive ? "connect" : "sandbox";
        string url = $"{baseUrl}/{env}/{taxId}";

        var payload = new {
            total = total,
            date = DateTime.Now.ToString("yyyy-MM-dd"),
            items = items
        };

        var json = JsonConvert.SerializeObject(payload);
        var content = new StringContent(json, Encoding.UTF8, "application/json");

        try {
            var response = await client.PostAsync(url, content);
            return response.IsSuccessStatusCode;
        } catch {
            return false;
        }
    }
}`,
                usageCode: `// Ù…Ø«Ø§Ù„ Ù„Ù„Ø§Ø³ØªØ®Ø¯Ø§Ù… Ø¯Ø§Ø®Ù„ Ø²Ø± Ø§Ù„Ø­ÙØ¸
var items = new[] {
    new { name = "Service A", price = 100, qty = 1 }
};

var taxService = new TaxService();
bool success = await taxService.SendInvoice(100, items, false); // false = Sandbox

if(success) MessageBox.Show("ØªÙ… Ø§Ù„Ø±Ø¨Ø· Ø¨Ù†Ø¬Ø§Ø­");`
            },

            python: {
                step1Desc: "Ø¶Ø¹ Ù‡Ø°Ù‡ Ø§Ù„Ø¯Ø§Ù„Ø© ÙÙŠ Ù…Ù„Ù `utils.py` Ø£Ùˆ `services.py`.",
                mainCode: `import requests
from datetime import datetime

def send_invoice_to_tax(total, items, is_live=False):
    tax_id = "${currentTaxId}"
    base_url = "${baseUrl}"
    env = "connect" if is_live else "sandbox"
    url = f"{base_url}/{env}/{tax_id}"

    payload = {
        "total": total,
        "date": datetime.now().strftime("%Y-%m-%d"),
        "items": items
    }

    try:
        res = requests.post(url, json=payload)
        return res.status_code == 200, res.json()
    except Exception as e:
        return False, str(e)`,
                usageCode: `# Ø§Ø³ØªØ®Ø¯Ø§Ù… Ø§Ù„Ø¯Ø§Ù„Ø©
cart = [
    {"name": "Book", "price": 20, "qty": 3}
]

success, response = send_invoice_to_tax(60, cart, is_live=False)

if success:
    print("âœ… ØªÙ… Ø§Ù„ØªÙˆØ«ÙŠÙ‚")
else:
    print("âŒ ÙØ´Ù„:", response)`
            }
        };

        function updateContent() {
            const lang = document.getElementById('langSelect').value;
            const contentArea = document.getElementById('contentArea');
            
            if (contentData[lang]) {
                contentArea.style.display = 'block';
                
                // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ù†ØµÙˆØµ
                document.getElementById('step1-desc').innerHTML = contentData[lang].step1Desc;
                document.getElementById('mainCode').innerText = contentData[lang].mainCode;
                document.getElementById('usageCode').innerText = contentData[lang].usageCode;
            }
        }

        function copyToClipboard(elementId) {
            const text = document.getElementById(elementId).innerText;
            navigator.clipboard.writeText(text).then(() => {
                alert("ØªÙ… Ø§Ù„Ù†Ø³Ø® Ù„Ù„Ø­Ø§ÙØ¸Ø©! ğŸ“‹");
            });
        }
    </script>

</body>
</html>
