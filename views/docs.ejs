<!DOCTYPE html>
<html lang="ar" dir="rtl">

<head>
    <meta charset="UTF-8">
    <title>MetaConnect - ÙƒÙˆØ¯ Ø§Ù„Ø±Ø¨Ø· Ø§Ù„Ø´Ø§Ù…Ù„</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.rtl.min.css">
    <style>
        body {
            background: #f4f6f9;
            font-family: 'Segoe UI', Tahoma, sans-serif;
            padding: 30px;
        }

        .main-card {
            background: white;
            padding: 40px;
            border-radius: 12px;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.05);
            max-width: 900px;
            margin: 0 auto;
        }

        .code-box {
            background: #1e1e1e;
            color: #f8f8f2;
            padding: 20px;
            border-radius: 8px;
            font-family: 'Consolas', monospace;
            direction: ltr;
            text-align: left;
            white-space: pre-wrap;
            font-size: 14px;
            max-height: 600px;
            overflow-y: auto;
            border: 1px solid #333;
        }

        .badge-env {
            font-size: 0.8em;
            padding: 5px 10px;
            border-radius: 4px;
        }

        .badge-sandbox {
            background: #ffc107;
            color: #000;
        }

        .badge-live {
            background: #198754;
            color: #fff;
        }
    </style>
</head>

<body>

    <div class="main-card">

        <div class="text-center mb-4">
            <h2 class="fw-bold text-primary">âš¡ Ø§Ù„Ù…ÙˆÙ„Ø¯ Ø§Ù„Ø¢Ù„ÙŠ Ù„ÙƒÙˆØ¯ Ø§Ù„Ø±Ø¨Ø·</h2>
            <p class="text-muted">ÙƒÙˆØ¯ ÙˆØ§Ø­Ø¯ ÙŠØ¹Ù…Ù„ ÙÙŠ Ø¨ÙŠØ¦Ø© Ø§Ù„ØªØ¬Ø±Ø¨Ø© (Sandbox) ÙˆØ§Ù„Ø¥Ù†ØªØ§Ø¬ (Live).</p>
            <% if(userType==='developer' && exampleConfig) { %>
                <div class="alert alert-light border d-inline-block py-1 px-3">
                    Ø§Ù„Ù…Ø¹Ø±Ù Ø§Ù„Ø®Ø§Øµ Ø¨Ùƒ: <strong>
                        <%= exampleConfig.tax_id %>
                    </strong>
                </div>
                <% } %>
        </div>

        <!-- Ø§Ù„Ù‚Ø§Ø¦Ù…Ø© -->
        <div class="mb-4">
            <label class="fw-bold mb-2">Ø§Ø®ØªØ± Ù„ØºØ© Ø§Ù„Ù†Ø¸Ø§Ù… Ù„Ø¯ÙŠÙƒ:</label>
            <select id="langSelect" class="form-select form-select-lg" onchange="generateCode()">
                <option value="" selected disabled>-- Ø§Ø®ØªØ± Ø§Ù„Ù„ØºØ© --</option>
                <option value="js">JavaScript (HTML / Frontend)</option>
                <option value="php">PHP (Backend / Laravel)</option>
                <option value="csharp">C# (Desktop Apps)</option>
                <option value="python">Python (Odoo / Django)</option>
            </select>
        </div>

        <!-- Ù…Ù†Ø·Ù‚Ø© Ø§Ù„ÙƒÙˆØ¯ -->
        <div id="resultArea" style="display:none;">
            <div class="alert alert-info d-flex align-items-center">
                <span class="fs-4 me-2">ğŸ’¡</span>
                <div>
                    <strong>Ø·Ø±ÙŠÙ‚Ø© Ø§Ù„ØªØ±ÙƒÙŠØ¨:</strong>
                    <ol class="mb-0 ps-3">
                        <li>Ø§Ù†Ø³Ø® Ù‡Ø°Ø§ Ø§Ù„ÙƒÙˆØ¯ ÙˆØ¶Ø¹Ù‡ ÙÙŠ <strong>Ù†Ù‡Ø§ÙŠØ© Ø§Ù„Ù…Ù„Ù</strong> Ø§Ù„Ø®Ø§Øµ Ø¨Ø§Ù„ÙÙˆØ§ØªÙŠØ±.</li>
                        <li>Ø¹Ù†Ø¯ Ø­ÙØ¸ Ø§Ù„ÙØ§ØªÙˆØ±Ø©ØŒ Ø§Ø³ØªØ¯Ø¹Ù Ø§Ù„Ø¯Ø§Ù„Ø©: de>sendInvoiceToTax(...)</code></li>
                    </ol>
                </div>
            </div>

            <div class="position-relative">
                <div class="code-box" id="codeDisplay"></div>
                <button class="btn btn-primary position-absolute top-0 end-0 m-3" onclick="copyCode()">Ù†Ø³Ø® Ø§Ù„ÙƒÙˆØ¯
                    ğŸ“‹</button>
            </div>
        </div>

    </div>

    <!-- Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø®ÙÙŠØ© -->
    <input type="hidden" id="taxId" value="<%= exampleConfig ? exampleConfig.tax_id : 'YOUR_TAX_ID' %>">

    <script>
        const taxId = document.getElementById('taxId').value;
        const baseUrl = "http://localhost:3000/api/v1"; // Ø±Ø§Ø¨Ø· Ø§Ù„Ø³ÙŠØ±ÙØ±

        const templates = {
            js: `/**
 * ğŸ”Œ Ø¯Ø§Ù„Ø© Ø§Ù„Ø±Ø¨Ø· Ø§Ù„Ø¶Ø±ÙŠØ¨ÙŠ Ø§Ù„Ø´Ø§Ù…Ù„Ø© (MetaConnect)
 * Ø¶Ø¹ Ù‡Ø°Ù‡ Ø§Ù„Ø¯Ø§Ù„Ø© ÙÙŠ Ù†Ù‡Ø§ÙŠØ© Ù…Ù„Ù Javascript Ø£Ùˆ Ø¯Ø§Ø®Ù„ ÙˆØ³Ù… <script>
 */
async function sendInvoiceToTax(totalAmount, itemsList, isLive = false) {
    // 1. ØªØ­Ø¯ÙŠØ¯ Ø§Ù„Ø¨ÙŠØ¦Ø© (Sandbox Ø£Ùˆ Live)
    const env = isLive ? 'connect' : 'sandbox';
    const url = \`${baseUrl}/\${env}/${taxId}\`;

    console.log(\`ğŸ“¡ Ø¬Ø§Ø±ÙŠ Ø§Ù„Ø¥Ø±Ø³Ø§Ù„ Ø¥Ù„Ù‰ Ø¨ÙŠØ¦Ø©: \${isLive ? 'Live ğŸš€' : 'Sandbox ğŸ§ª'}\`);

    // 2. ØªØ¬Ù‡ÙŠØ² Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª
    const payload = {
        total: totalAmount,
        date: new Date().toISOString().split('T')[0],
        items: itemsList.map(item => ({ name: item.name, price: item.price, qty: item.quantity || 1 }))
    };

    try {
        // 3. Ø§Ù„Ø¥Ø±Ø³Ø§Ù„
        const res = await fetch(url, {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify(payload)
        });

        const data = await res.json();

        // 4. Ø§Ù„Ù†ØªÙŠØ¬Ø©
        if (res.ok) {
            console.log("âœ… ØªÙ… Ø§Ù„Ø±Ø¨Ø· Ø¨Ù†Ø¬Ø§Ø­:", data);
            alert("ØªÙ… ØªÙˆØ«ÙŠÙ‚ Ø§Ù„ÙØ§ØªÙˆØ±Ø© Ø¶Ø±ÙŠØ¨ÙŠØ§Ù‹ Ø¨Ù†Ø¬Ø§Ø­! âœ…");
        } else {
            console.error("âŒ Ø®Ø·Ø£:", data);
            alert("ÙØ´Ù„ Ø§Ù„ØªÙˆØ«ÙŠÙ‚: " + (data.message || "Ø®Ø·Ø£ ØºÙŠØ± Ù…Ø¹Ø±ÙˆÙ"));
        }
    } catch (err) {
        console.error("âš ï¸ Ø®Ø·Ø£ Ø§ØªØµØ§Ù„:", err);
    }
}

// ==========================================
// ğŸŸ¢ Ù…Ø«Ø§Ù„ Ù„Ù„Ø§Ø³ØªØ®Ø¯Ø§Ù… (Ø¶Ø¹Ù‡ Ø¯Ø§Ø®Ù„ Ø²Ø± Ø§Ù„Ø­ÙØ¸):
// sendInvoiceToTax(150.00, cartItems, false); // false Ù„Ù„ØªØ¬Ø±Ø¨Ø©
// ==========================================`,

            php: `<?php
/**
 * ğŸ”Œ Ø¯Ø§Ù„Ø© Ø§Ù„Ø±Ø¨Ø· Ø§Ù„Ø¶Ø±ÙŠØ¨ÙŠ Ø§Ù„Ø´Ø§Ù…Ù„Ø© (MetaConnect)
 * Ø§Ù†Ø³Ø® Ù‡Ø°Ù‡ Ø§Ù„Ø¯Ø§Ù„Ø© ÙˆØ¶Ø¹Ù‡Ø§ ÙÙŠ Ù…Ù„Ù Ø§Ù„Ù€ Helper Ø£Ùˆ Ø§Ù„Ù€ Controller
 */
function sendInvoiceToTax($total, $items, $isLive = false) {
    $taxId = "${taxId}";
    $env = $isLive ? 'connect' : 'sandbox';
    $url = "${baseUrl}/$env/$taxId";

    // ØªØ¬Ù‡ÙŠØ² Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª
    $data = [
        "total" => $total,
        "date" => date("Y-m-d"),
        "items" => $items
    ];

    // Ø§Ù„Ø¥Ø±Ø³Ø§Ù„
    $ch = curl_init($url);
    curl_setopt($ch, CURLOPT_RETURNTRANSFER, true);
    curl_setopt($ch, CURLOPT_POST, true);
    curl_setopt($ch, CURLOPT_POSTFIELDS, json_encode($data));
    curl_setopt($ch, CURLOPT_HTTPHEADER, ['Content-Type: application/json']);
    
    $response = curl_exec($ch);
    $httpCode = curl_getinfo($ch, CURLINFO_HTTP_CODE);
    curl_close($ch);

    // Ø§Ù„Ù†ØªÙŠØ¬Ø©
    if ($httpCode == 200) {
        return ["success" => true, "data" => json_decode($response, true)];
    } else {
        return ["success" => false, "error" => $response];
    }
}

// ==========================================
// ğŸŸ¢ Ù…Ø«Ø§Ù„ Ù„Ù„Ø§Ø³ØªØ®Ø¯Ø§Ù…:
// sendInvoiceToTax(500, $cartItems, false); // false Ù„Ù„ØªØ¬Ø±Ø¨Ø©
// ==========================================
?>`,

            csharp: `// ğŸ”Œ ÙƒÙˆØ¯ Ø§Ù„Ø±Ø¨Ø· C#
// Ø¶Ø¹Ù‡ ÙƒÙ€ Class Ù…Ù†ÙØµÙ„ Ø£Ùˆ Ø¯Ø§Ø®Ù„ Ø§Ù„Ù€ Form
using System.Net.Http;
using System.Text;
using Newtonsoft.Json;

public class MetaConnect
{
    private static readonly HttpClient client = new HttpClient();
    private string taxId = "${taxId}";
    private string baseUrl = "${baseUrl}";

    public async void SendInvoice(decimal total, object items, bool isLive = false)
    {
        string env = isLive ? "connect" : "sandbox";
        string url = $"{baseUrl}/{env}/{taxId}";

        var payload = new {
            total = total,
            date = DateTime.Now.ToString("yyyy-MM-dd"),
            items = items
        };

        var json = JsonConvert.SerializeObject(payload);
        var content = new StringContent(json, Encoding.UTF8, "application/json");

        try {
            var response = await client.PostAsync(url, content);
            string result = await response.Content.ReadAsStringAsync();

            if (response.IsSuccessStatusCode) {
                System.Windows.Forms.MessageBox.Show("âœ… ØªÙ… Ø§Ù„ØªÙˆØ«ÙŠÙ‚ Ø¨Ù†Ø¬Ø§Ø­!");
            } else {
                System.Windows.Forms.MessageBox.Show("âŒ ÙØ´Ù„: " + result);
            }
        } catch (Exception ex) {
            System.Windows.Forms.MessageBox.Show("Ø®Ø·Ø£: " + ex.Message);
        }
    }
}

// ==========================================
// ğŸŸ¢ Ù…Ø«Ø§Ù„ Ù„Ù„Ø§Ø³ØªØ®Ø¯Ø§Ù…:
// new MetaConnect().SendInvoice(100.00, cart, false);
// ==========================================`,

            python: `# ğŸ”Œ Ø¯Ø§Ù„Ø© Ø§Ù„Ø±Ø¨Ø· Python
import requests
import json
from datetime import datetime

def send_invoice_to_tax(total, items, is_live=False):
    tax_id = "${taxId}"
    base_url = "${baseUrl}"
    env = "connect" if is_live else "sandbox"
    url = f"{base_url}/{env}/{tax_id}"

    payload = {
        "total": total,
        "date": datetime.now().strftime("%Y-%m-%d"),
        "items": items
    }

    try:
        res = requests.post(url, json=payload)
        if res.status_code == 200:
            print("âœ… Success:", res.json())
        else:
            print("âŒ Failed:", res.text)
    except Exception as e:
        print("âš ï¸ Error:", e)

# ==========================================
# ğŸŸ¢ Ù…Ø«Ø§Ù„ Ù„Ù„Ø§Ø³ØªØ®Ø¯Ø§Ù…:
# send_invoice_to_tax(200, cart_items, False) # False for Sandbox
# ==========================================`,
        };

        function generateCode() {
            const lang = document.getElementById('langSelect').value;
            if (templates[lang]) {
                document.getElementById('resultArea').style.display = 'block';
                document.getElementById('codeDisplay').innerText = templates[lang];
            }
        }

        function copyCode() {
            const text = document.getElementById('codeDisplay').innerText;
            navigator.clipboard.writeText(text);
            alert("ØªÙ… Ù†Ø³Ø® Ø§Ù„ÙƒÙˆØ¯! Ø¶Ø¹Ù‡ ÙÙŠ Ù…Ù„ÙÙƒ Ø§Ù„Ø¢Ù†.");
        }
    </script>

</body>

</html>